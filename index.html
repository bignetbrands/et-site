<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>$ET ‚Äî Phone Home to Profit</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --green: #39ff14;
    --green-dim: #39ff1466;
    --green-dark: #0a3d00;
    --dark: #030a03;
    --darker: #010501;
    --panel: #0a150a;
    --panel-border: #1a3a1a;
    --text: #c8f7c0;
    --text-dim: #5a8a52;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--darker); color: var(--text); font-family: 'Space Mono', monospace; overflow-x: hidden; cursor: crosshair; }
  .stars { position: fixed; inset: 0; z-index: 0; pointer-events: none; }
  .stars canvas { width: 100%; height: 100%; }
  .scanlines { position: fixed; inset: 0; z-index: 999; pointer-events: none; background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,255,0,0.015) 2px, rgba(0,255,0,0.015) 4px); }
  .vignette { position: fixed; inset: 0; z-index: 998; pointer-events: none; background: radial-gradient(ellipse at center, transparent 50%, rgba(0,0,0,0.7) 100%); }
  .page-wrapper { position: relative; z-index: 1; min-height: 100vh; }

  /* PRELOADER */
  .preloader { position: fixed; inset: 0; z-index: 10000; background: var(--darker); display: flex; justify-content: center; align-items: center; padding: 24px; transition: opacity 0.8s ease, visibility 0.8s ease; }
  .preloader.done { opacity: 0; visibility: hidden; pointer-events: none; }
  .preloader-terminal { width: 100%; max-width: 660px; background: #050f05; border: 1px solid var(--panel-border); border-radius: 4px; overflow: hidden; box-shadow: 0 0 60px rgba(57,255,20,0.05); transition: opacity 0.7s ease, transform 0.7s ease; position: relative; z-index: 2; }
  .preloader-terminal.shrink { opacity: 0; transform: scale(0.92) translateY(-30px); pointer-events: none; }
  .preloader-header { display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: #0a1a0a; border-bottom: 1px solid var(--panel-border); }
  .preloader-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--green-dark); }
  .preloader-dot.active { background: var(--green); box-shadow: 0 0 6px var(--green); }
  .preloader-title { font-family: 'Space Mono', monospace; font-size: 11px; color: var(--text-dim); letter-spacing: 2px; margin-left: 8px; text-transform: uppercase; }
  .preloader-body { padding: 20px; min-height: 380px; max-height: 440px; overflow: hidden; position: relative; display: flex; flex-direction: column; }
  .preloader-lines { flex: 1; overflow: hidden; display: flex; flex-direction: column; }
  .preloader-line { font-family: 'Space Mono', monospace; font-size: 12px; line-height: 1.7; color: var(--text-dim); white-space: pre; opacity: 0; transform: translateY(4px); animation: lineIn 0.15s ease forwards; flex-shrink: 0; }
  .preloader-line.green { color: var(--green); text-shadow: 0 0 8px var(--green-dim); }
  .preloader-line.dim { color: #2a5a22; }
  .preloader-line.warn { color: #ffaa00; text-shadow: 0 0 8px rgba(255,170,0,0.3); }
  .preloader-line.success { color: var(--green); font-weight: 700; text-shadow: 0 0 12px var(--green); }
  .preloader-line.error { color: #ff3c3c; text-shadow: 0 0 6px rgba(255,60,60,0.3); }
  @keyframes lineIn { to { opacity: 1; transform: translateY(0); } }
  .preloader-progress { padding: 12px 20px 16px; display: flex; align-items: center; gap: 12px; }
  .preloader-bar-track { flex: 1; height: 3px; background: var(--panel-border); border-radius: 2px; overflow: hidden; }
  .preloader-bar-fill { height: 100%; width: 0%; background: var(--green); box-shadow: 0 0 10px var(--green); border-radius: 2px; transition: width 0.3s ease; }
  .preloader-percent { font-family: 'Space Mono', monospace; font-size: 11px; color: var(--green); min-width: 36px; text-align: right; }
  .preloader-radar { position: absolute; bottom: 16px; right: 20px; width: 70px; height: 70px; opacity: 0.2; }
  .radar-circle { position: absolute; inset: 0; border: 1px solid var(--green); border-radius: 50%; animation: radarPing 2s ease-out infinite; }
  .radar-circle:nth-child(2) { animation-delay: 0.5s; }
  .radar-circle:nth-child(3) { animation-delay: 1s; }
  @keyframes radarPing { 0% { transform: scale(0.1); opacity: 1; } 100% { transform: scale(1); opacity: 0; } }
  .radar-dot { position: absolute; top: 50%; left: 50%; width: 4px; height: 4px; background: var(--green); border-radius: 50%; transform: translate(-50%,-50%); box-shadow: 0 0 8px var(--green); }

  /* Galaxy */
  .galaxy-phase { position: absolute; inset: 0; opacity: 0; transition: opacity 1s ease; pointer-events: none; }
  .galaxy-phase.active { opacity: 1; }
  #galaxyCanvas { position: absolute; inset: 0; width: 100%; height: 100%; }
  .galaxy-hud { position: absolute; top: 24px; left: 28px; font-family: 'Space Mono', monospace; font-size: 10px; color: var(--text-dim); letter-spacing: 2px; text-transform: uppercase; z-index: 2; opacity: 0; transition: opacity 0.6s ease; }
  .galaxy-hud.show { opacity: 1; }
  .galaxy-hud-line { margin-bottom: 4px; }
  .galaxy-hud-line span { color: var(--green); text-shadow: 0 0 6px var(--green-dim); }
  .galaxy-hud-right { position: absolute; top: 24px; right: 28px; font-family: 'Space Mono', monospace; font-size: 10px; color: var(--text-dim); letter-spacing: 2px; text-transform: uppercase; text-align: right; z-index: 2; opacity: 0; transition: opacity 0.6s ease; }
  .galaxy-hud-right.show { opacity: 1; }
  .galaxy-final { position: absolute; bottom: 12%; left: 50%; transform: translateX(-50%); text-align: center; z-index: 3; opacity: 0; transition: opacity 1s ease; pointer-events: none; }
  .galaxy-final.show { opacity: 1; }
  .galaxy-final-title { font-family: 'Silkscreen', cursive; font-size: clamp(36px, 7vw, 64px); color: var(--green); text-shadow: 0 0 30px var(--green), 0 0 80px var(--green-dim), 0 0 160px rgba(57,255,20,0.1); letter-spacing: 8px; line-height: 1; margin-bottom: 12px; }
  .galaxy-final-sub { font-family: 'Space Mono', monospace; font-size: 12px; color: var(--text-dim); letter-spacing: 4px; text-transform: uppercase; }
  .galaxy-final-sub span { color: var(--green); }
  .galaxy-star-name { position: absolute; z-index: 3; opacity: 0; transition: opacity 0.8s ease; pointer-events: none; font-family: 'Silkscreen', cursive; font-size: clamp(14px, 2.5vw, 22px); color: var(--green); text-shadow: 0 0 16px var(--green), 0 0 40px var(--green-dim); letter-spacing: 3px; text-transform: uppercase; white-space: nowrap; }
  .galaxy-star-name.show { opacity: 1; }
  .page-wrapper.hidden { opacity: 0; pointer-events: none; }
  .page-wrapper { transition: opacity 0.6s ease 0.3s; }

  /* BACKROOM OVERLAY ‚Äî fullscreen takeover */
  .backroom-overlay { position: fixed; inset: 0; z-index: 9000; background: var(--darker); opacity: 0; visibility: hidden; transition: opacity 0.5s ease, visibility 0.5s ease; }
  .backroom-overlay.open { opacity: 1; visibility: visible; }
  .backroom-overlay canvas { position: absolute; inset: 0; width: 100%; height: 100%; cursor: grab; }
  .backroom-overlay canvas:active { cursor: grabbing; }
  .galaxy-section-hud { position: absolute; top: 16px; left: 20px; font-family: 'Space Mono', monospace; font-size: 9px; color: var(--text-dim); letter-spacing: 2px; text-transform: uppercase; z-index: 2; pointer-events: none; }
  .galaxy-section-hud span { color: var(--green); text-shadow: 0 0 6px var(--green-dim); }
  .galaxy-section-hint { position: absolute; bottom: 16px; left: 50%; transform: translateX(-50%); font-family: 'Space Mono', monospace; font-size: 9px; color: var(--text-dim); letter-spacing: 3px; text-transform: uppercase; z-index: 2; pointer-events: none; opacity: 0.6; transition: opacity 0.5s; }
  .galaxy-section-hint.hidden { opacity: 0; }
  .galaxy-section-zoom { position: absolute; bottom: 16px; right: 20px; display: flex; gap: 6px; z-index: 3; }
  .galaxy-section-zoom button { width: 32px; height: 32px; background: rgba(10,21,10,0.8); border: 1px solid var(--panel-border); color: var(--green); font-family: 'Space Mono', monospace; font-size: 16px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; }
  .galaxy-section-zoom button:hover { border-color: var(--green); box-shadow: 0 0 10px var(--green-dim); }
  .backroom-back { position: absolute; top: 16px; right: 20px; z-index: 5; display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: rgba(10,21,10,0.85); border: 1px solid var(--panel-border); color: var(--text-dim); font-family: 'Space Mono', monospace; font-size: 10px; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; transition: all 0.3s; backdrop-filter: blur(4px); }
  .backroom-back:hover { border-color: var(--green); color: var(--green); box-shadow: 0 0 12px var(--green-dim); }

  /* Sidebar */
  .br-sidebar { position: absolute; top: 0; right: 0; width: 320px; height: calc(100vh - 48px); background: rgba(3,10,3,0.94); border-left: 1px solid var(--panel-border); z-index: 6; overflow-y: auto; padding: 20px; opacity: 0; visibility: hidden; transform: translateX(20px); transition: all 0.3s ease; backdrop-filter: blur(8px); scrollbar-width: thin; scrollbar-color: var(--green-dark) transparent; }
  .br-sidebar.open { opacity: 1; visibility: visible; transform: translateX(0); }
  .br-sidebar::-webkit-scrollbar { width: 4px; }
  .br-sidebar::-webkit-scrollbar-track { background: transparent; }
  .br-sidebar::-webkit-scrollbar-thumb { background: var(--green-dark); border-radius: 2px; }
  .br-sidebar-close { position: absolute; top: 12px; right: 12px; background: none; border: none; color: var(--text-dim); font-size: 16px; cursor: pointer; font-family: 'Space Mono', monospace; z-index: 2; }
  .br-sidebar-close:hover { color: var(--green); }
  .br-star-header { margin-bottom: 12px; padding-right: 24px; }
  .br-star-name { font-family: 'Silkscreen', cursive; font-size: 14px; color: var(--green); text-shadow: 0 0 12px var(--green-dim); letter-spacing: 2px; margin-bottom: 8px; }
  .br-star-meta { font-size: 9px; color: var(--text-dim); letter-spacing: 1px; text-transform: uppercase; line-height: 1.8; }
  .br-star-meta span { color: var(--text); }
  .br-star-desc { font-size: 10px; color: var(--text); line-height: 1.7; padding: 12px 0; border-bottom: 1px solid var(--panel-border); margin-bottom: 12px; }
  .br-section { margin-bottom: 16px; }
  .br-section-title { font-family: 'Silkscreen', cursive; font-size: 10px; color: var(--green); letter-spacing: 2px; margin-bottom: 10px; text-shadow: 0 0 6px var(--green-dim); }

  /* Planet cards */
  .br-planet-card { background: rgba(10,21,10,0.6); border: 1px solid var(--panel-border); padding: 12px; margin-bottom: 8px; transition: border-color 0.2s; }
  .br-planet-card:hover { border-color: var(--green-dim); }
  .br-planet-name { font-size: 11px; color: var(--green); font-weight: 700; letter-spacing: 1px; margin-bottom: 8px; }
  .br-planet-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 4px 12px; font-size: 8px; color: var(--text-dim); letter-spacing: 1px; text-transform: uppercase; }
  .br-planet-stats span { color: var(--text); }
  .br-esi { margin-top: 8px; }
  .br-esi-label { font-size: 8px; color: var(--text-dim); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 4px; display: flex; justify-content: space-between; }
  .br-esi-label span { font-weight: 700; }
  .br-esi-bar { height: 4px; background: var(--panel-border); border-radius: 2px; overflow: hidden; }
  .br-esi-fill { height: 100%; border-radius: 2px; transition: width 0.5s ease; }
  .br-esi-fill.high { background: var(--green); box-shadow: 0 0 6px var(--green); }
  .br-esi-fill.medium { background: #ffaa00; box-shadow: 0 0 6px rgba(255,170,0,0.5); }
  .br-esi-fill.low { background: #ff5533; }

  /* Transit items */
  .br-transit-item { font-size: 9px; color: var(--text-dim); padding: 8px; background: rgba(10,21,10,0.4); border: 1px solid var(--panel-border); margin-bottom: 6px; letter-spacing: 0.5px; line-height: 1.6; }
  .br-transit-item .transit-planet { color: var(--green); font-weight: 700; }
  .br-transit-item .transit-time { color: var(--text); }

  /* Action buttons */
  .br-actions { border-top: 1px solid var(--panel-border); padding-top: 12px; }
  .br-action-btn { display: block; width: 100%; padding: 10px 12px; margin-bottom: 6px; background: rgba(10,21,10,0.6); border: 1px solid var(--panel-border); color: var(--text-dim); font-family: 'Space Mono', monospace; font-size: 9px; letter-spacing: 1px; text-decoration: none; text-align: left; cursor: pointer; transition: all 0.2s; }
  .br-action-btn:hover { border-color: var(--green); color: var(--green); box-shadow: 0 0 8px var(--green-dim); }

  /* Bottom mission control bar */
  .br-bar { position: absolute; bottom: 0; left: 0; right: 0; height: 48px; background: rgba(3,10,3,0.92); border-top: 1px solid var(--panel-border); display: flex; align-items: center; padding: 0 20px; gap: 0; z-index: 5; backdrop-filter: blur(6px); }
  .br-bar-item { display: flex; align-items: center; gap: 6px; padding: 0 16px; }
  .br-bar-feed { flex: 1; overflow: hidden; }
  .br-bar-icon { font-size: 12px; }
  .br-bar-label { font-size: 8px; color: var(--text-dim); letter-spacing: 2px; text-transform: uppercase; }
  .br-bar-value { font-size: 10px; color: var(--green); font-weight: 700; letter-spacing: 1px; text-shadow: 0 0 6px var(--green-dim); white-space: nowrap; }
  .br-bar-divider { width: 1px; height: 24px; background: var(--panel-border); flex-shrink: 0; }
  .br-bar-feed .br-bar-value { overflow: hidden; text-overflow: ellipsis; }
  body.backroom-active { overflow: hidden; }
  body.onboard-active { overflow: hidden; }

  /* ONBOARDING OVERLAY */
  .onboard-overlay { position: fixed; inset: 0; z-index: 9500; background: rgba(2,8,2,0.96); opacity: 0; visibility: hidden; transition: opacity 0.4s ease, visibility 0.4s ease; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(6px); }
  .onboard-overlay.open { opacity: 1; visibility: visible; }
  .onboard-box { width: 100%; max-width: 520px; max-height: 90vh; overflow-y: auto; padding: 40px 36px; scrollbar-width: thin; scrollbar-color: var(--green-dark) transparent; }
  .onboard-box::-webkit-scrollbar { width: 4px; }
  .onboard-box::-webkit-scrollbar-thumb { background: var(--green-dark); border-radius: 2px; }
  .onboard-close { position: absolute; top: 20px; right: 24px; background: none; border: none; color: var(--text-dim); font-size: 24px; cursor: pointer; font-family: 'Space Mono', monospace; z-index: 2; }
  .onboard-close:hover { color: var(--green); }
  .onboard-title { font-family: 'Silkscreen', cursive; font-size: 20px; color: var(--green); text-shadow: 0 0 20px var(--green-dim); letter-spacing: 4px; text-align: center; margin-bottom: 8px; }
  .onboard-sub { font-size: 11px; color: var(--text-dim); text-align: center; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 32px; line-height: 1.8; }
  .onboard-sub span { color: var(--green); }
  .onboard-step { display: flex; gap: 16px; margin-bottom: 24px; padding: 16px; background: rgba(10,21,10,0.5); border: 1px solid var(--panel-border); transition: border-color 0.3s; }
  .onboard-step:hover { border-color: var(--green-dim); }
  .onboard-step-num { font-family: 'Silkscreen', cursive; font-size: 24px; color: var(--green); text-shadow: 0 0 10px var(--green-dim); flex-shrink: 0; width: 36px; text-align: center; line-height: 1; padding-top: 2px; }
  .onboard-step-content { flex: 1; }
  .onboard-step-title { font-size: 12px; color: var(--text); font-weight: 700; letter-spacing: 1px; margin-bottom: 6px; }
  .onboard-step-desc { font-size: 10px; color: var(--text-dim); line-height: 1.7; letter-spacing: 0.5px; }
  .onboard-step-desc a { color: var(--green); text-decoration: none; border-bottom: 1px solid var(--green-dark); }
  .onboard-step-desc a:hover { text-shadow: 0 0 6px var(--green-dim); }
  .onboard-step-links { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px; }
  .onboard-link { display: inline-block; padding: 6px 12px; background: rgba(10,21,10,0.8); border: 1px solid var(--panel-border); color: var(--green); font-family: 'Space Mono', monospace; font-size: 9px; letter-spacing: 1px; text-decoration: none; transition: all 0.2s; }
  .onboard-link:hover { border-color: var(--green); box-shadow: 0 0 10px var(--green-dim); }
  .onboard-link.primary { background: rgba(57,255,20,0.1); border-color: var(--green-dim); }
  .onboard-footer { text-align: center; margin-top: 28px; padding-top: 20px; border-top: 1px solid var(--panel-border); }
  .onboard-footer-text { font-size: 9px; color: var(--text-dim); letter-spacing: 1px; line-height: 1.8; margin-bottom: 16px; }
  .onboard-footer-text span { color: var(--green); }
  .onboard-cta { display: inline-block; padding: 12px 32px; background: rgba(57,255,20,0.08); border: 1px solid var(--green); color: var(--green); font-family: 'Silkscreen', cursive; font-size: 12px; letter-spacing: 3px; text-decoration: none; cursor: pointer; transition: all 0.3s; text-shadow: 0 0 8px var(--green-dim); }
  .onboard-cta:hover { background: rgba(57,255,20,0.15); box-shadow: 0 0 20px var(--green-dim); }
  @media (max-width: 768px) { .onboard-box { padding: 32px 20px; } .onboard-title { font-size: 16px; } .onboard-step { flex-direction: column; gap: 8px; } .onboard-step-num { width: auto; } }

  /* REWARDS OVERLAY */
  body.rewards-active { overflow: hidden; }
  .rewards-overlay { position: fixed; inset: 0; z-index: 9500; background: rgba(2,8,2,0.96); opacity: 0; visibility: hidden; transition: opacity 0.4s ease, visibility 0.4s ease; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(6px); }
  .rewards-overlay.open { opacity: 1; visibility: visible; }
  .rewards-box { width: 100%; max-width: 580px; max-height: 90vh; overflow-y: auto; padding: 40px 36px; scrollbar-width: thin; scrollbar-color: var(--green-dark) transparent; }
  .rewards-box::-webkit-scrollbar { width: 4px; }
  .rewards-box::-webkit-scrollbar-thumb { background: var(--green-dark); border-radius: 2px; }
  .rewards-close { position: absolute; top: 20px; right: 24px; background: none; border: none; color: var(--text-dim); font-size: 24px; cursor: pointer; font-family: 'Space Mono', monospace; z-index: 2; }
  .rewards-close:hover { color: var(--green); }
  .rewards-title { font-family: 'Silkscreen', cursive; font-size: 20px; color: var(--green); text-shadow: 0 0 20px var(--green-dim); letter-spacing: 4px; text-align: center; margin-bottom: 8px; }
  .rewards-sub { font-size: 11px; color: var(--text-dim); text-align: center; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 28px; line-height: 1.8; }
  .rewards-sub span { color: var(--green); }

  /* How it works flow */
  .rewards-flow { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 28px; padding: 16px; background: rgba(10,21,10,0.5); border: 1px solid var(--panel-border); flex-wrap: wrap; }
  .rewards-flow-node { font-size: 9px; color: var(--green); letter-spacing: 1px; text-align: center; padding: 8px 12px; border: 1px solid var(--green-dark); background: rgba(57,255,20,0.04); }
  .rewards-flow-arrow { color: var(--green-dim); font-size: 14px; }
  .rewards-flow-node.highlight { border-color: var(--green); background: rgba(57,255,20,0.1); text-shadow: 0 0 6px var(--green-dim); }

  /* Registration form */
  .rewards-form { margin-bottom: 28px; padding: 20px; background: rgba(10,21,10,0.5); border: 1px solid var(--panel-border); }
  .rewards-form-title { font-size: 12px; color: var(--text); font-weight: 700; letter-spacing: 1px; margin-bottom: 4px; }
  .rewards-form-desc { font-size: 9px; color: var(--text-dim); letter-spacing: 0.5px; margin-bottom: 16px; line-height: 1.7; }
  .rewards-input-group { margin-bottom: 12px; }
  .rewards-label { display: block; font-size: 9px; color: var(--text-dim); letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 6px; }
  .rewards-input { width: 100%; padding: 10px 12px; background: rgba(2,8,2,0.8); border: 1px solid var(--panel-border); color: var(--green); font-family: 'Space Mono', monospace; font-size: 11px; letter-spacing: 0.5px; outline: none; transition: border-color 0.2s; box-sizing: border-box; }
  .rewards-input::placeholder { color: rgba(57,255,20,0.25); }
  .rewards-input:focus { border-color: var(--green-dim); box-shadow: 0 0 8px rgba(57,255,20,0.1); }
  .rewards-submit { display: block; width: 100%; padding: 12px; margin-top: 16px; background: rgba(57,255,20,0.08); border: 1px solid var(--green); color: var(--green); font-family: 'Silkscreen', cursive; font-size: 11px; letter-spacing: 3px; cursor: pointer; transition: all 0.3s; }
  .rewards-submit:hover { background: rgba(57,255,20,0.15); box-shadow: 0 0 15px var(--green-dim); }
  .rewards-submit:disabled { opacity: 0.4; cursor: not-allowed; }
  .rewards-status { font-size: 9px; text-align: center; margin-top: 10px; letter-spacing: 1px; min-height: 14px; }

  /* Leaderboard */
  .rewards-leaderboard { margin-bottom: 20px; }
  .rewards-lb-title { font-size: 12px; color: var(--text); font-weight: 700; letter-spacing: 1px; margin-bottom: 12px; }
  .rewards-lb-header, .rewards-lb-row { display: grid; grid-template-columns: 32px 1fr 90px 80px; gap: 8px; padding: 8px 10px; font-size: 9px; letter-spacing: 0.5px; align-items: center; }
  .rewards-lb-header { color: var(--text-dim); text-transform: uppercase; letter-spacing: 1.5px; border-bottom: 1px solid var(--panel-border); }
  .rewards-lb-row { color: var(--text-dim); border-bottom: 1px solid rgba(57,255,20,0.05); transition: background 0.2s; }
  .rewards-lb-row:hover { background: rgba(57,255,20,0.04); }
  .rewards-lb-rank { color: var(--green); font-family: 'Silkscreen', cursive; font-size: 12px; }
  .rewards-lb-user { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .rewards-lb-credits { color: var(--text); text-align: right; }
  .rewards-lb-share { color: var(--green); text-align: right; font-family: 'Silkscreen', cursive; }
  .rewards-lb-row.you { background: rgba(57,255,20,0.06); border-color: var(--green-dark); }
  .rewards-lb-row.you .rewards-lb-user { color: var(--green); }
  .rewards-lb-empty { text-align: center; padding: 24px; color: var(--text-dim); font-size: 10px; letter-spacing: 1px; line-height: 1.8; border: 1px dashed var(--panel-border); }

  /* Pool stats */
  .rewards-pool { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 24px; }
  .rewards-pool-card { padding: 14px; background: rgba(10,21,10,0.5); border: 1px solid var(--panel-border); text-align: center; }
  .rewards-pool-value { font-family: 'Silkscreen', cursive; font-size: 16px; color: var(--green); text-shadow: 0 0 10px var(--green-dim); margin-bottom: 4px; }
  .rewards-pool-label { font-size: 8px; color: var(--text-dim); letter-spacing: 1.5px; text-transform: uppercase; }

  /* Claim section */
  .rewards-claim { text-align: center; padding: 20px; border: 1px solid var(--panel-border); background: rgba(10,21,10,0.3); }
  .rewards-claim-amount { font-family: 'Silkscreen', cursive; font-size: 22px; color: var(--green); text-shadow: 0 0 15px var(--green-dim); margin-bottom: 4px; }
  .rewards-claim-label { font-size: 9px; color: var(--text-dim); letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 14px; }
  .rewards-claim-btn { display: inline-block; padding: 12px 40px; background: rgba(57,255,20,0.08); border: 1px solid var(--green); color: var(--green); font-family: 'Silkscreen', cursive; font-size: 12px; letter-spacing: 3px; cursor: pointer; transition: all 0.3s; }
  .rewards-claim-btn:hover { background: rgba(57,255,20,0.15); box-shadow: 0 0 20px var(--green-dim); }
  .rewards-claim-btn:disabled { opacity: 0.35; cursor: not-allowed; }

  .rewards-note { font-size: 8px; color: var(--text-dim); text-align: center; letter-spacing: 1px; margin-top: 20px; line-height: 1.8; }
  .rewards-note span { color: var(--green); }

  @media (max-width: 768px) { .rewards-box { padding: 32px 20px; } .rewards-title { font-size: 16px; } .rewards-pool { grid-template-columns: 1fr; } .rewards-lb-header, .rewards-lb-row { grid-template-columns: 28px 1fr 70px 60px; font-size: 8px; } }

  @media (max-width: 768px) {
    .br-sidebar { width: 260px; padding: 16px; }
    .br-star-name { font-size: 12px; }
    .backroom-back { top: 12px; right: 12px; font-size: 9px; padding: 6px 12px; }
    .br-bar { padding: 0 10px; height: 42px; }
    .br-bar-item { padding: 0 8px; }
    .br-bar-label { display: none; }
    .br-bar-feed .br-bar-label { display: inline; }
  }
  @media (max-width: 480px) {
    .br-sidebar { width: 100%; height: 50vh; top: auto; bottom: 48px; border-left: none; border-top: 1px solid var(--panel-border); transform: translateY(20px); }
    .br-sidebar.open { transform: translateY(0); }
  }

  /* NAV */
  nav { position: fixed; top: 0; left: 0; right: 0; z-index: 100; padding: 16px 32px; display: flex; justify-content: space-between; align-items: center; background: linear-gradient(180deg, var(--darker), transparent); backdrop-filter: blur(8px); border-bottom: 1px solid var(--panel-border); }
  .nav-logo { font-family: 'Silkscreen', cursive; font-size: 24px; color: var(--green); text-shadow: 0 0 20px var(--green), 0 0 40px var(--green-dim); letter-spacing: 4px; }
  .nav-links { display: flex; gap: 8px; }
  .nav-links a { color: var(--text-dim); text-decoration: none; font-size: 11px; text-transform: uppercase; letter-spacing: 2px; padding: 8px 14px; border: 1px solid transparent; transition: all 0.3s; }
  .nav-links a:hover { color: var(--green); border-color: var(--green-dim); text-shadow: 0 0 10px var(--green-dim); }

  /* HERO */
  .hero { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 120px 24px 80px; position: relative; }
  .hero-et-face {
    width: clamp(300px, 42vw, 480px);
    height: clamp(360px, 50vw, 560px);
    margin-bottom: 8px;
    opacity: 0;
    animation: fadeIn 1.2s ease 0.3s forwards;
    position: relative;
  }
  #etFaceCanvas {
    width: 100%; height: 100%;
    display: block;
  }
  .hero-ascii-text {
    font-family: 'Space Mono', monospace; font-size: 12px; line-height: 1.6;
    color: var(--green); text-shadow: 0 0 10px var(--green-dim);
    margin-bottom: 32px; white-space: pre; text-align: center;
    opacity: 0; animation: fadeIn 1s ease 0.6s forwards;
    letter-spacing: 1px;
  }
  .hero-title { font-family: 'Silkscreen', cursive; font-size: clamp(60px, 12vw, 140px); color: var(--green); text-shadow: 0 0 20px var(--green), 0 0 60px var(--green-dim), 0 0 120px rgba(57,255,20,0.15); letter-spacing: 12px; line-height: 1; margin-bottom: 16px; opacity: 0; animation: glitchIn 0.8s ease 0.6s forwards; }
  @keyframes glitchIn { 0% { opacity: 0; transform: translateX(-20px) skewX(-5deg); } 30% { opacity: 1; transform: translateX(10px) skewX(2deg); } 60% { transform: translateX(-5px) skewX(-1deg); } 100% { opacity: 1; transform: translateX(0) skewX(0); } }
  @keyframes fadeIn { to { opacity: 1; } }
  .hero-tagline { font-size: 16px; color: var(--text-dim); letter-spacing: 6px; text-transform: uppercase; margin-bottom: 24px; opacity: 0; animation: fadeIn 1s ease 1s forwards; }
  .hero-tagline span { color: var(--green); text-shadow: 0 0 10px var(--green-dim); }
  .cta-group { display: flex; gap: 16px; flex-wrap: wrap; justify-content: center; opacity: 0; animation: fadeIn 1s ease 1.3s forwards; }
  .btn { display: inline-flex; align-items: center; gap: 8px; padding: 14px 28px; font-family: 'Space Mono', monospace; font-size: 13px; font-weight: 700; text-decoration: none; text-transform: uppercase; letter-spacing: 2px; border: 1px solid; transition: all 0.3s; position: relative; overflow: hidden; }
  .btn-primary { background: var(--green); color: var(--dark); border-color: var(--green); box-shadow: 0 0 20px var(--green-dim), inset 0 0 20px rgba(57,255,20,0.1); }
  .btn-primary:hover { box-shadow: 0 0 40px var(--green), 0 0 80px var(--green-dim); transform: translateY(-2px); }
  .btn-ghost { background: transparent; color: var(--green); border-color: var(--panel-border); }
  .btn-ghost:hover { border-color: var(--green); box-shadow: 0 0 20px var(--green-dim); transform: translateY(-2px); }
  .ca-section { margin-top: 48px; opacity: 0; animation: fadeIn 1s ease 1.6s forwards; }
  .ca-label { font-size: 10px; text-transform: uppercase; letter-spacing: 4px; color: var(--text-dim); margin-bottom: 12px; }
  .ca-box { display: inline-flex; align-items: center; gap: 12px; background: var(--panel); border: 1px solid var(--panel-border); padding: 12px 20px; font-size: 12px; color: var(--green); cursor: pointer; transition: all 0.3s; max-width: 90vw; overflow: hidden; }
  .ca-box:hover { border-color: var(--green); box-shadow: 0 0 20px var(--green-dim); }
  .ca-box .ca-text { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 400px; }
  .ca-box .copy-icon { flex-shrink: 0; opacity: 0.5; transition: opacity 0.3s; }
  .ca-box:hover .copy-icon { opacity: 1; }
  .copy-toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%) translateY(-20px); background: var(--green); color: var(--dark); padding: 10px 24px; font-size: 12px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; z-index: 200; opacity: 0; pointer-events: none; transition: all 0.3s; box-shadow: 0 0 30px var(--green); }
  .copy-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
  .beam { position: absolute; bottom: -200px; left: 50%; transform: translateX(-50%); width: 300px; height: 400px; background: conic-gradient(from 0deg at 50% 0%, transparent 40%, var(--green-dim) 50%, transparent 60%); opacity: 0.12; filter: blur(30px); pointer-events: none; animation: beamPulse 6s ease-in-out infinite; }
  @keyframes beamPulse { 0%, 100% { opacity: 0.08; } 50% { opacity: 0.18; } }

  /* SECTIONS */
  .section-label { font-size: 10px; text-transform: uppercase; letter-spacing: 6px; color: var(--text-dim); margin-bottom: 12px; }
  .section-title { font-family: 'Silkscreen', cursive; font-size: clamp(28px, 5vw, 48px); color: var(--green); text-shadow: 0 0 20px var(--green-dim); margin-bottom: 48px; letter-spacing: 4px; }
  .trade-section { padding: 80px 24px; text-align: center; }
  .trade-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; max-width: 900px; margin: 0 auto; }
  .trade-card { background: var(--panel); border: 1px solid var(--panel-border); padding: 32px 24px; text-decoration: none; transition: all 0.3s; position: relative; overflow: hidden; }
  .trade-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: var(--green); transform: scaleX(0); transition: transform 0.3s; }
  .trade-card:hover::before { transform: scaleX(1); }
  .trade-card:hover { border-color: var(--green-dim); box-shadow: 0 0 30px rgba(57,255,20,0.08); transform: translateY(-4px); }
  .trade-card-icon { font-size: 32px; margin-bottom: 16px; }
  .trade-card-name { font-family: 'Silkscreen', cursive; font-size: 16px; color: var(--green); margin-bottom: 8px; letter-spacing: 2px; }
  .trade-card-desc { font-size: 11px; color: var(--text-dim); letter-spacing: 1px; line-height: 1.6; }
  .about-section { padding: 80px 24px; max-width: 800px; margin: 0 auto; text-align: center; }
  .about-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; margin-top: 48px; }
  .about-card { background: var(--panel); border: 1px solid var(--panel-border); padding: 32px 20px; }
  .about-card-number { font-family: 'Silkscreen', cursive; font-size: 36px; color: var(--green); text-shadow: 0 0 20px var(--green-dim); margin-bottom: 8px; }
  .about-card-label { font-size: 10px; text-transform: uppercase; letter-spacing: 3px; color: var(--text-dim); }
  .community-section { padding: 80px 24px; text-align: center; }
  .community-links { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; margin-top: 40px; }
  .community-btn { display: inline-flex; align-items: center; gap: 10px; padding: 16px 28px; background: var(--panel); border: 1px solid var(--panel-border); color: var(--text); text-decoration: none; font-family: 'Space Mono', monospace; font-size: 13px; letter-spacing: 2px; text-transform: uppercase; transition: all 0.3s; }
  .community-btn:hover { border-color: var(--green); color: var(--green); box-shadow: 0 0 20px var(--green-dim); transform: translateY(-3px); }
  .community-btn svg { width: 18px; height: 18px; fill: currentColor; }
  .divider { width: 80%; max-width: 400px; height: 1px; background: linear-gradient(90deg, transparent, var(--panel-border), transparent); margin: 0 auto; }
  footer { padding: 40px 24px; text-align: center; border-top: 1px solid var(--panel-border); }
  .footer-text { font-size: 10px; color: var(--text-dim); letter-spacing: 3px; text-transform: uppercase; }
  .footer-text span { color: var(--green); }
  .ticker-wrap { overflow: hidden; white-space: nowrap; background: var(--panel); border-top: 1px solid var(--panel-border); border-bottom: 1px solid var(--panel-border); padding: 12px 0; }
  .ticker { display: inline-block; animation: ticker 20s linear infinite; font-size: 11px; letter-spacing: 4px; text-transform: uppercase; color: var(--text-dim); }
  .ticker span { color: var(--green); }
  @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
  .hero-title:hover { animation: glitch 0.3s linear; }
  @keyframes glitch { 0% { text-shadow: 0 0 20px var(--green), 2px 2px 0 #ff003c, -2px -2px 0 #00f7ff; } 50% { text-shadow: 0 0 20px var(--green), -2px 2px 0 #ff003c, 2px -2px 0 #00f7ff; } 100% { text-shadow: 0 0 20px var(--green), 0 0 60px var(--green-dim); } }
  .reveal { opacity: 0; transform: translateY(30px); transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1); }
  .reveal.visible { opacity: 1; transform: translateY(0); }
  @media (max-width: 768px) { nav { padding: 12px 16px; } .nav-links { display: none; } .hero { padding: 100px 16px 60px; } .hero-et-face { width: 65vw; height: 70vw; } .about-grid { grid-template-columns: 1fr; } .trade-grid { grid-template-columns: 1fr; } .ca-box .ca-text { max-width: 200px; } .galaxy-hud, .galaxy-hud-right { font-size: 8px; top: 12px; } .galaxy-hud { left: 12px; } .galaxy-hud-right { right: 12px; } }
  @media (max-width: 480px) { .trade-grid { grid-template-columns: 1fr; } .cta-group { flex-direction: column; align-items: center; } .btn { width: 100%; max-width: 280px; justify-content: center; } }
</style>
</head>
<body>
<div class="stars"><canvas id="starfield"></canvas></div>
<div class="scanlines"></div>
<div class="vignette"></div>
<div class="copy-toast" id="copyToast">‚úì Contract Copied</div>

<!-- PRELOADER -->
<div class="preloader" id="preloader">
  <div class="preloader-terminal" id="terminalPhase">
    <div class="preloader-header">
      <div class="preloader-dot active"></div><div class="preloader-dot"></div><div class="preloader-dot"></div>
      <span class="preloader-title">et_signal_relay v4.2.0</span>
    </div>
    <div class="preloader-body">
      <div class="preloader-lines" id="preloaderLines"></div>
      <div class="preloader-radar"><div class="radar-circle"></div><div class="radar-circle"></div><div class="radar-circle"></div><div class="radar-dot"></div></div>
    </div>
    <div class="preloader-progress">
      <div class="preloader-bar-track"><div class="preloader-bar-fill" id="preloaderBar"></div></div>
      <span class="preloader-percent" id="preloaderPercent">0%</span>
    </div>
  </div>
  <div class="galaxy-phase" id="galaxyPhase">
    <canvas id="galaxyCanvas"></canvas>
    <div class="galaxy-hud" id="galaxyHud">
      <div class="galaxy-hud-line">system: <span>milky way galactic map</span></div>
      <div class="galaxy-hud-line">mode: <span>signal triangulation</span></div>
      <div class="galaxy-hud-line">data: <span>nasa exoplanet archive + hyg catalog</span></div>
      <div class="galaxy-hud-line" id="galaxyStatus">status: <span>scanning...</span></div>
    </div>
    <div class="galaxy-hud-right" id="galaxyHudRight">
      <div class="galaxy-hud-line">origin: <span>earth</span></div>
      <div class="galaxy-hud-line" id="galaxyDist">distance: <span>calculating...</span></div>
      <div class="galaxy-hud-line" id="galaxyCoord">sector: <span>‚Äî</span></div>
      <div class="galaxy-hud-line" id="galaxyStar">star: <span>‚Äî</span></div>
    </div>
    <div class="galaxy-star-name" id="galaxyStarLabel"></div>
    <div class="galaxy-final" id="galaxyFinal">
      <div class="galaxy-final-title">$ET</div>
      <div class="galaxy-final-sub">signal <span>confirmed</span> ‚Äî og contract ‚Äî phone home</div>
    </div>
  </div>
</div>

<!-- BACKROOM OVERLAY ‚Äî fullscreen research hub -->
<div class="backroom-overlay" id="backroomOverlay">
  <canvas id="galaxySectionCanvas"></canvas>
  <button class="backroom-back" id="backroomBack">‚Üê Exit Backroom</button>

  <!-- Top-left HUD -->
  <div class="galaxy-section-hud" id="galaxySectionHud">
    <div style="font-family:'Silkscreen',cursive;font-size:14px;color:var(--green);letter-spacing:3px;margin-bottom:8px;text-shadow:0 0 10px var(--green-dim);">THE BACKROOM</div>
    <div>milky way ‚Äî <span>interactive galactic map</span></div>
    <div>data: <span>nasa exoplanet archive (live)</span></div>
    <div id="galaxySectionStatus">zoom: <span>1.0x</span></div>
  </div>

  <!-- Zoom controls -->
  <div class="galaxy-section-zoom">
    <button id="zoomIn" title="Zoom in">+</button>
    <button id="zoomOut" title="Zoom out">‚àí</button>
    <button id="zoomReset" title="Reset view" style="font-size:10px;">‚åÇ</button>
  </div>
  <div class="galaxy-section-hint" id="galaxyHint">drag to pan ¬∑ scroll to zoom ¬∑ click stars for data</div>

  <!-- Right sidebar ‚Äî star/planet detail panel -->
  <div class="br-sidebar" id="brSidebar">
    <button class="br-sidebar-close" id="brSidebarClose">‚úï</button>

    <!-- Star header -->
    <div class="br-star-header">
      <div class="br-star-name" id="brStarName"></div>
      <div class="br-star-meta" id="brStarMeta"></div>
    </div>

    <!-- Star description -->
    <div class="br-star-desc" id="brStarDesc"></div>

    <!-- Planets section -->
    <div class="br-section" id="brPlanetsSection" style="display:none;">
      <div class="br-section-title">‚óà planetary system</div>
      <div class="br-planets" id="brPlanets"></div>
    </div>

    <!-- Observation targets -->
    <div class="br-section" id="brTransitSection" style="display:none;">
      <div class="br-section-title">‚óà upcoming transits</div>
      <div class="br-transits" id="brTransits"></div>
    </div>

    <!-- Actions -->
    <div class="br-section br-actions">
      <div class="br-section-title">‚óà contribute</div>
      <button onclick="openOnboarding()" class="br-action-btn" style="border:none;text-align:left;">‚ö° Join Team $ET ‚Äî Step-by-step guide</button>
      <a href="https://einsteinathome.org/" target="_blank" class="br-action-btn">üì° Einstein@home ‚Äî Pulsar Search</a>
      <a href="https://www.seti.org/citizen-science" target="_blank" class="br-action-btn">üî≠ SETI Institute Citizen Science</a>
    </div>
  </div>

  <!-- Bottom mission control bar -->
  <div class="br-bar" id="brBar">
    <div class="br-bar-item">
      <span class="br-bar-icon">üåç</span>
      <span class="br-bar-label">HZ Planets</span>
      <span class="br-bar-value" id="brBarPlanets">‚Äî</span>
    </div>
    <div class="br-bar-divider"></div>
    <div class="br-bar-item">
      <span class="br-bar-icon">‚≠ê</span>
      <span class="br-bar-label">Cataloged Stars</span>
      <span class="br-bar-value" id="brBarStars">‚Äî</span>
    </div>
    <div class="br-bar-divider"></div>
    <div class="br-bar-item">
      <span class="br-bar-icon">üì°</span>
      <span class="br-bar-label">Data Source</span>
      <span class="br-bar-value" id="brBarSource">loading...</span>
    </div>
    <div class="br-bar-divider"></div>
    <div class="br-bar-item br-bar-feed">
      <span class="br-bar-icon">‚ö°</span>
      <span class="br-bar-label">Feed</span>
      <span class="br-bar-value" id="brBarFeed">initializing...</span>
    </div>
    <div class="br-bar-divider"></div>
    <div class="br-bar-item" style="cursor:pointer;" onclick="openOnboarding()">
      <span class="br-bar-value" style="font-size:9px;letter-spacing:2px;">‚óà JOIN SEARCH</span>
    </div>
    <div class="br-bar-divider"></div>
    <div class="br-bar-item" style="cursor:pointer;" onclick="openRewards()">
      <span class="br-bar-value" style="font-size:9px;letter-spacing:2px;">‚ö° REWARDS</span>
    </div>
  </div>
</div>

<!-- ONBOARDING OVERLAY -->
<div class="onboard-overlay" id="onboardOverlay">
  <button class="onboard-close" id="onboardClose">‚úï</button>
  <div class="onboard-box">
    <div class="onboard-title">JOIN THE SEARCH</div>
    <div class="onboard-sub">donate your computer's idle power to real <span>SETI research</span><br>join team <span>$ET</span> on Einstein@home (searching for signals from space)</div>

    <div class="onboard-step">
      <div class="onboard-step-num">1</div>
      <div class="onboard-step-content">
        <div class="onboard-step-title">Download BOINC</div>
        <div class="onboard-step-desc">BOINC is a free app by UC Berkeley that runs scientific computing tasks invisibly in the background using your idle CPU/GPU. It's safe, lightweight, and you won't even notice it.</div>
        <div class="onboard-step-links">
          <a href="https://boinc.berkeley.edu/download.php" target="_blank" class="onboard-link primary">‚Üí Download BOINC</a>
          <a href="https://boinc.berkeley.edu/dl/boinc_installer.exe" target="_blank" class="onboard-link">Windows</a>
          <a href="https://boinc.berkeley.edu/dl/BOINC.dmg" target="_blank" class="onboard-link">macOS</a>
        </div>
      </div>
    </div>

    <div class="onboard-step">
      <div class="onboard-step-num">2</div>
      <div class="onboard-step-content">
        <div class="onboard-step-title">Create an Einstein@home account</div>
        <div class="onboard-step-desc">Einstein@home uses your computer to search radio telescope data for pulsars, gravitational waves, and continuous signals from neutron stars. It's one of the most active SETI-adjacent projects in the world.</div>
        <div class="onboard-step-links">
          <a href="https://einsteinathome.org/join" target="_blank" class="onboard-link primary">‚Üí Sign up at einsteinathome.org</a>
        </div>
      </div>
    </div>

    <div class="onboard-step">
      <div class="onboard-step-num">3</div>
      <div class="onboard-step-content">
        <div class="onboard-step-title">Attach Einstein@home in BOINC</div>
        <div class="onboard-step-desc">Open BOINC Manager ‚Üí click <span style="color:var(--green)">Add Project</span> ‚Üí select <span style="color:var(--green)">Einstein@home</span> from the list ‚Üí sign in with your new account. BOINC will start downloading work units automatically.</div>
      </div>
    </div>

    <div class="onboard-step" style="border-color:var(--green-dark);position:relative;">
      <div class="onboard-step-num">4</div>
      <div class="onboard-step-content">
        <div class="onboard-step-title">Join Team $ET <span style="font-size:8px;color:var(--green);background:rgba(57,255,20,0.1);padding:2px 8px;margin-left:8px;letter-spacing:2px;vertical-align:middle;">COMING SOON</span></div>
        <div class="onboard-step-desc">Our official team on Einstein@home is being set up. Once live, search for <span style="color:var(--green)">$ET</span> in Community ‚Üí Teams to join. Your credits will count toward the crew's collective search. For now, just completing steps 1‚Äì3 means you're already contributing to the search for ET.</div>
        <div class="onboard-step-links">
          <a href="https://einsteinathome.org/community/teams" target="_blank" class="onboard-link">‚Üí Browse teams</a>
        </div>
      </div>
    </div>

    <div class="onboard-step">
      <div class="onboard-step-num">5</div>
      <div class="onboard-step-content">
        <div class="onboard-step-title">Let it run</div>
        <div class="onboard-step-desc">That's it. BOINC runs silently when your computer is idle ‚Äî analyzing real radio telescope data from Arecibo, LIGO, and Fermi. Your computer is now part of a global network scanning the sky for signals. Welcome to the crew.</div>
      </div>
    </div>

    <div class="onboard-footer">
      <div class="onboard-footer-text">
        your computer joins a global network searching the cosmos<br>
        <span>5.2 million+</span> people have contributed to SETI through BOINC<br>
        einstein@home has discovered <span>90+ pulsars</span> using volunteer computers<br>
        every cycle of your CPU brings us closer to an answer
      </div>
      <a href="https://einsteinathome.org/join" target="_blank" class="onboard-cta">ENLIST NOW</a>
    </div>
  </div>
</div>

<!-- REWARDS OVERLAY -->
<div class="rewards-overlay" id="rewardsOverlay">
  <button class="rewards-close" id="rewardsClose">‚úï</button>
  <div class="rewards-box">
    <div class="rewards-title">COMPUTE REWARDS</div>
    <div class="rewards-sub">crunch data for science. <span>earn SOL</span> from $ET trading fees.<br>rewards distributed proportionally by <span>BOINC computing credits</span></div>

    <!-- How it works flow -->
    <div class="rewards-flow">
      <div class="rewards-flow-node">$ET TRADES<br><span style="font-size:7px;color:var(--text-dim);">on pump.fun</span></div>
      <div class="rewards-flow-arrow">‚Üí</div>
      <div class="rewards-flow-node">CREATOR FEES<br><span style="font-size:7px;color:var(--text-dim);">0.05‚Äì0.95% SOL</span></div>
      <div class="rewards-flow-arrow">‚Üí</div>
      <div class="rewards-flow-node highlight">REWARD POOL<br><span style="font-size:7px;color:var(--text-dim);">accumulated SOL</span></div>
      <div class="rewards-flow-arrow">‚Üí</div>
      <div class="rewards-flow-node">YOUR WALLET<br><span style="font-size:7px;color:var(--text-dim);">proportional share</span></div>
    </div>

    <!-- Pool stats -->
    <div class="rewards-pool">
      <div class="rewards-pool-card">
        <div class="rewards-pool-value" id="rewardsPoolTotal">‚Äî</div>
        <div class="rewards-pool-label">Pool (SOL)</div>
      </div>
      <div class="rewards-pool-card">
        <div class="rewards-pool-value" id="rewardsPoolMembers">0</div>
        <div class="rewards-pool-label">Contributors</div>
      </div>
      <div class="rewards-pool-card">
        <div class="rewards-pool-value" id="rewardsPoolCredits">0</div>
        <div class="rewards-pool-label">Total Credits</div>
      </div>
    </div>

    <!-- Registration -->
    <div class="rewards-form" id="rewardsForm">
      <div class="rewards-form-title">Register for Rewards</div>
      <div class="rewards-form-desc">Link your Solana wallet to your Einstein@home account. Your share of the reward pool is calculated from your BOINC computing credits relative to the team total.</div>
      <div class="rewards-input-group">
        <label class="rewards-label">Solana Wallet Address</label>
        <input type="text" class="rewards-input" id="rewardsWallet" placeholder="e.g. 7xKX...3mFv" maxlength="44" autocomplete="off" spellcheck="false">
      </div>
      <div class="rewards-input-group">
        <label class="rewards-label">Einstein@home Username</label>
        <input type="text" class="rewards-input" id="rewardsBoinc" placeholder="Your Einstein@home display name" autocomplete="off" spellcheck="false">
      </div>
      <button class="rewards-submit" id="rewardsRegister">REGISTER</button>
      <div class="rewards-status" id="rewardsStatus"></div>
    </div>

    <!-- Leaderboard -->
    <div class="rewards-leaderboard">
      <div class="rewards-lb-title">‚óà Leaderboard ‚Äî Team $ET</div>
      <div class="rewards-lb-header">
        <span>#</span>
        <span>User</span>
        <span style="text-align:right">Credits</span>
        <span style="text-align:right">Share</span>
      </div>
      <div id="rewardsLeaderboard">
        <div class="rewards-lb-empty">
          No contributors yet.<br>Be the first to register and start earning.
        </div>
      </div>
    </div>

    <!-- Claim -->
    <div class="rewards-claim" id="rewardsClaim">
      <div class="rewards-claim-amount" id="rewardsClaimAmount">0.000 SOL</div>
      <div class="rewards-claim-label">Your Unclaimed Rewards</div>
      <button class="rewards-claim-btn" id="rewardsClaimBtn" disabled>CLAIM REWARDS</button>
    </div>

    <div class="rewards-note">
      rewards are calculated each epoch based on your <span>BOINC credits</span> vs team total<br>
      creator fees from every <span>$ET</span> trade on pump.fun flow directly to this pool<br>
      the more you compute, the more you earn ‚Äî <span>science pays</span>
    </div>
  </div>
</div>

<!-- MAIN PAGE -->
<div class="page-wrapper hidden" id="pageWrapper">
  <nav>
    <div class="nav-logo">$ET</div>
    <div class="nav-links"><a href="#backroom">Backroom</a><a href="javascript:void(0)" onclick="openOnboarding()">Join Search</a><a href="javascript:void(0)" onclick="openRewards()">Rewards</a><a href="#trade">Trade</a><a href="#community">Community</a></div>
  </nav>
  <section class="hero">
    <div class="beam"></div>
    <div class="hero-et-face" id="etFaceWrap">
      <canvas id="etFaceCanvas"></canvas>
    </div>
    <p class="hero-tagline">the search for <span>extraterrestrial</span> life</p>
    <div class="cta-group">
      <a href="javascript:void(0)" class="btn btn-primary" id="enterBackroom">‚óà Enter Backroom</a>
      <a href="javascript:void(0)" class="btn btn-ghost" onclick="openOnboarding()">‚ú¶ Join the Search</a>
      <a href="javascript:void(0)" class="btn btn-ghost" onclick="openRewards()">‚ö° Earn Rewards</a>
    </div>
  </section>

  <!-- POST CONTENT -->
  <div class="ticker-wrap">
    <div class="ticker"><span>$ET</span> ¬∑ BORN WITH A DOLLAR SIGN ¬∑ <span>$ET</span> ¬∑ MOST ICONIC CHARACTER EVER ¬∑ <span>$ET</span> ¬∑ OG CONTRACT ¬∑ <span>$ET</span> ¬∑ PHONE HOME TO PROFIT ¬∑ <span>$ET</span> ¬∑ THE TICKER THAT WAS ALWAYS MEANT TO BE ¬∑ <span>$ET</span> ¬∑ BORN WITH A DOLLAR SIGN ¬∑ <span>$ET</span> ¬∑ MOST ICONIC CHARACTER EVER ¬∑ <span>$ET</span> ¬∑ OG CONTRACT ¬∑ <span>$ET</span> ¬∑ PHONE HOME TO PROFIT ¬∑ <span>$ET</span> ¬∑ THE TICKER THAT WAS ALWAYS MEANT TO BE ¬∑ </div>
  </div>
  <section class="trade-section" id="trade">
    <div class="reveal"><div class="section-label">‚Äî Beam Up ‚Äî</div><h2 class="section-title">Trade $ET</h2></div>
    <div class="trade-grid reveal">
      <a href="https://trade.padre.gg/trade/solana/A1NZ4kjhJxdmMMHQTGF8HaU7k6JCh5gSyHEeAKE3xRMF?rk=lxpamp" target="_blank" class="trade-card"><div class="trade-card-icon">‚ö°</div><div class="trade-card-name">Padre</div><div class="trade-card-desc">Trade Terminal</div></a>
      <a href="https://axiom.trade/t/A1NZ4kjhJxdmMMHQTGF8HaU7k6JCh5gSyHEeAKE3xRMF/@lxpamp?chain=sol" target="_blank" class="trade-card"><div class="trade-card-icon">üõ∏</div><div class="trade-card-name">Axiom</div><div class="trade-card-desc">Trading Terminal</div></a>
      <a href="https://neo.bullx.io/terminal?chainId=1399811149&address=A1NZ4kjhJxdmMMHQTGF8HaU7k6JCh5gSyHEeAKE3xRMF" target="_blank" class="trade-card"><div class="trade-card-icon">üåÄ</div><div class="trade-card-name">Neo</div><div class="trade-card-desc">BullX Neo Bot</div></a>
    </div>
  </section>
  <div class="divider"></div>
  <section class="about-section" id="about">
    <div class="reveal">
      <div class="section-label">‚Äî The Mission ‚Äî</div>
      <h2 class="section-title">Why $ET?</h2>
      <p style="font-size: 14px; color: var(--text-dim); line-height: 2; letter-spacing: 1px; max-width: 560px; margin: 0 auto 40px;">The search for extraterrestrial intelligence is humanity's most profound question. <span style="color:var(--green);">$ET</span> is built around real NASA exoplanet data, real star catalogs, and the genuine scientific pursuit of finding life beyond Earth. The ticker was born with a dollar sign. The most iconic alien ever made. OG contract on Solana.</p>
    </div>
    <div class="about-grid reveal">
      <div class="about-card"><div class="about-card-number">$ET</div><div class="about-card-label">Built-in $ Ticker</div></div>
      <div class="about-card"><div class="about-card-number">OG</div><div class="about-card-label">Contract</div></div>
      <div class="about-card"><div class="about-card-number">NASA</div><div class="about-card-label">Real Exoplanet Data</div></div>
    </div>
    <div class="ca-section reveal" style="margin-top:48px;">
      <div class="ca-label">‚Äî Contract Address ‚Äî</div>
      <div class="ca-box" onclick="copyCA()">
        <span class="ca-text">A1NZ4kjhJxdmMMHQTGF8HaU7k6JCh5gSyHEeAKE3xRMF</span>
        <span class="copy-icon"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></span>
      </div>
    </div>
  </section>
  <div class="divider"></div>
  <section class="community-section" id="community">
    <div class="reveal"><div class="section-label">‚Äî Make Contact ‚Äî</div><h2 class="section-title">Join the Hive</h2></div>
    <div class="community-links reveal">
      <a href="https://x.com/i/communities/2024687278132769267" target="_blank" class="community-btn"><svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>X Community</a>
    </div>
  </section>
  <footer><p class="footer-text"><span>$ET</span> ‚Äî the ticker with a built-in dollar sign ‚Äî og contract on solana ‚Äî dyor</p></footer>
</div>


<script>
(function() {
  const linesEl = document.getElementById('preloaderLines');
  const barEl = document.getElementById('preloaderBar');
  const pctEl = document.getElementById('preloaderPercent');
  const preloader = document.getElementById('preloader');
  const pageWrapper = document.getElementById('pageWrapper');
  const terminalPhase = document.getElementById('terminalPhase');
  const galaxyPhase = document.getElementById('galaxyPhase');
  const galaxyHud = document.getElementById('galaxyHud');
  const galaxyHudRight = document.getElementById('galaxyHudRight');
  const galaxyFinal = document.getElementById('galaxyFinal');
  const galaxyStatus = document.getElementById('galaxyStatus');
  const galaxyDist = document.getElementById('galaxyDist');
  const galaxyCoord = document.getElementById('galaxyCoord');
  const galaxyStar = document.getElementById('galaxyStar');
  const galaxyStarLabel = document.getElementById('galaxyStarLabel');

  const setProg = v => { barEl.style.width = v+'%'; pctEl.textContent = Math.round(v)+'%'; };
  const wait = ms => new Promise(r => setTimeout(r, ms));

  // ======== MINIMAL TERMINAL AUDIO ========
  let audioCtx = null;
  let masterGain = null;

  function initAudio() {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    masterGain = audioCtx.createGain();
    masterGain.gain.value = 0.08;
    masterGain.connect(audioCtx.destination);
  }

  // Tiny soft tick
  function sfxTick() {
    if (!audioCtx) return;
    const t = audioCtx.currentTime;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'square';
    osc.frequency.setValueAtTime(700 + Math.random() * 300, t);
    gain.gain.setValueAtTime(0.03, t);
    gain.gain.exponentialRampToValueAtTime(0.001, t + 0.015);
    osc.connect(gain); gain.connect(masterGain);
    osc.start(t); osc.stop(t + 0.02);
  }

  // Two quiet low tones for signal detection
  function sfxWarn() {
    if (!audioCtx) return;
    const t = audioCtx.currentTime;
    for (let i = 0; i < 2; i++) {
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = 'sine';
      osc.frequency.setValueAtTime(440, t + i * 0.2);
      gain.gain.setValueAtTime(0.06, t + i * 0.2);
      gain.gain.exponentialRampToValueAtTime(0.001, t + i * 0.2 + 0.1);
      osc.connect(gain); gain.connect(masterGain);
      osc.start(t + i * 0.2); osc.stop(t + i * 0.2 + 0.12);
    }
  }

  // Blip on every terminal line
  const addLine = (t, c='', dl=0) => new Promise(r => setTimeout(() => {
    const el = document.createElement('div');
    el.className = 'preloader-line'+(c?' '+c:'');
    el.textContent = t;
    linesEl.appendChild(el);
    linesEl.scrollTop = linesEl.scrollHeight;
    if (t.trim()) sfxTick();
    r();
  }, dl));

  // ======== REAL STAR & EXOPLANET DATA ========

  // Real notable stars with galactic positions (normalized 0-1 map, center=0.5,0.5)
  // Sol is at ~26,000 ly from galactic center in the Orion Arm
  // Positions approximate galactic coordinates mapped to top-down view
  const REAL_STARS = [
    { name:'Proxima Centauri', dist:4.24, gx:0.6200, gy:0.4800, type:'M5.5V Red Dwarf', desc:'Closest star to the Sun. Hosts Proxima b, a rocky planet in the habitable zone. Part of the Alpha Centauri triple system.' },
    { name:'Alpha Centauri', dist:4.37, gx:0.6201, gy:0.4800, type:'G2V Sun-like Star', desc:'Third brightest star in the sky. Binary system (A and B) remarkably similar to our Sun. Nearest Sun-like stars.' },
    { name:'Barnard\'s Star', dist:5.96, gx:0.6201, gy:0.4801, type:'M4V Red Dwarf', desc:'Second closest star system. Has the highest proper motion of any known star. Possible super-Earth detected in 2018.' },
    { name:'Sirius', dist:8.6, gx:0.6202, gy:0.4799, type:'A1V Main Sequence', desc:'Brightest star in the night sky. Binary system ‚Äî Sirius B is a white dwarf, the first ever discovered. Sacred to ancient Egyptians.' },
    { name:'Vega', dist:25.0, gx:0.6204, gy:0.4795, type:'A0V Main Sequence', desc:'Fifth brightest star. Former North Star and future North Star again in ~12,000 years. Has a large debris disk ‚Äî possible planet formation.' },
    { name:'Arcturus', dist:36.7, gx:0.6206, gy:0.4805, type:'K1.5III Red Giant', desc:'Fourth brightest star. An ancient star ~7 billion years old, likely from a dwarf galaxy absorbed by the Milky Way.' },
    { name:'Betelgeuse', dist:700, gx:0.623, gy:0.477, type:'M1Ia Red Supergiant', desc:'One of the largest stars visible to the naked eye. Expected to go supernova within the next 100,000 years. Experienced the "Great Dimming" in 2019-2020.' },
    { name:'Rigel', dist:863, gx:0.624, gy:0.483, type:'B8Ia Blue Supergiant', desc:'Brightest star in Orion. ~120,000 times more luminous than the Sun. One of the most luminous stars in our region of the galaxy.' },
    { name:'Deneb', dist:2615, gx:0.632, gy:0.470, type:'A2Ia White Supergiant', desc:'~200,000 times more luminous than the Sun. One of the most distant stars visible to the naked eye. Part of the Summer Triangle.' },
    { name:'Polaris', dist:433, gx:0.622, gy:0.476, type:'F7Ib Supergiant', desc:'The current North Star. A Cepheid variable ‚Äî its brightness pulsation helped measure the scale of the universe.' },
    { name:'Crab Nebula (M1)', dist:6523, gx:0.643, gy:0.462, type:'Supernova Remnant', desc:'Remnant of a supernova observed by Chinese astronomers in 1054 AD. Contains a pulsar spinning 30 times per second.' },
    { name:'Orion Nebula (M42)', dist:1344, gx:0.626, gy:0.478, type:'Emission Nebula', desc:'Nearest massive star-forming region. Visible to the naked eye. Contains the Trapezium Cluster of hot young stars.' },
    { name:'Eagle Nebula (M16)', dist:7000, gx:0.585, gy:0.505, type:'Emission Nebula', desc:'Home of the famous "Pillars of Creation" photographed by Hubble. Active stellar nursery ‚Äî stars are being born here now.' },
    { name:'Double Cluster', dist:7600, gx:0.665, gy:0.440, type:'Open Cluster', desc:'NGC 869 and NGC 884. Two young star clusters visible to the naked eye. Each contains hundreds of blue supergiant stars.' },
    { name:'Heart Nebula', dist:7500, gx:0.670, gy:0.435, type:'Emission Nebula', desc:'IC 1805. Named for its heart-like shape. Powered by a cluster of hot O-type stars at its center.' },
    { name:'Cassiopeia A', dist:11000, gx:0.680, gy:0.425, type:'Supernova Remnant', desc:'Strongest radio source in the sky outside our solar system. The explosion light reached Earth around 1680 AD.' },
    { name:'Lagoon Nebula (M8)', dist:5200, gx:0.575, gy:0.495, type:'Emission Nebula', desc:'One of the brightest nebulae visible without a telescope. Contains Herschel 36, a young star ionizing the gas around it.' },
    { name:'Sagittarius A*', dist:26000, gx:0.500, gy:0.500, type:'Supermassive Black Hole', desc:'The 4-million-solar-mass black hole at the center of our galaxy. First imaged by the Event Horizon Telescope in 2022.' },
    { name:'Eta Carinae', dist:7500, gx:0.580, gy:0.515, type:'Luminous Blue Variable', desc:'One of the most massive and luminous stars known. ~5 million times brighter than the Sun. Could go hypernova.' },
    { name:'Westerlund 2', dist:20000, gx:0.530, gy:0.530, type:'Young Star Cluster', desc:'One of the most massive young star clusters in the Milky Way. Contains some of the hottest and most luminous stars known.' },
    { name:'Earth (Sol)', dist:0, gx:0.620, gy:0.480, type:'G2V Main Sequence', desc:'Our home star system. Sol is 4.6 billion years old, located in the Orion Arm, ~26,000 light-years from the galactic center. Home to 8 planets and the only confirmed life in the universe ‚Äî so far.' },
  ];

  // Stars that can be signal sources ‚Äî distant, in spiral arms, with interesting names
  const SIGNAL_CANDIDATES = [
    { name:'Tabby\'s Star (KIC 8462852)', gx:0.645, gy:0.458, sector:'Cygnus Arm', distLy:'1,470', desc:'anomalous dimming pattern' },
    { name:'TRAPPIST-1', gx:0.6210, gy:0.4808, sector:'Orion Spur', distLy:'40.7', desc:'7-planet system in habitable zone' },
    { name:'Kepler-442', gx:0.650, gy:0.450, sector:'Perseus Arm', distLy:'1,206', desc:'super-Earth in habitable zone' },
    { name:'TOI-700', gx:0.622, gy:0.481, sector:'Orion Spur', distLy:'101.4', desc:'Earth-sized planet in HZ' },
    { name:'Kepler-62', gx:0.655, gy:0.445, sector:'Perseus Arm', distLy:'1,200', desc:'two planets in habitable zone' },
    { name:'K2-18', gx:0.623, gy:0.479, sector:'Orion Spur', distLy:'124', desc:'possible atmospheric biosignature' },
    { name:'PSR B1919+21', gx:0.648, gy:0.453, sector:'Cygnus Arm', distLy:'2,283', desc:'first pulsar ever detected' },
    { name:'HD 164922', gx:0.618, gy:0.484, sector:'Sagittarius Spur', distLy:'72', desc:'multi-planet system' },
    { name:'GJ 667 C', gx:0.6205, gy:0.4803, sector:'Orion Spur', distLy:'23.6', desc:'triple star, habitable planet' },
    { name:'LHS 1140', gx:0.621, gy:0.481, sector:'Orion Spur', distLy:'49', desc:'rocky super-Earth in HZ' },
    { name:'Ross 128', gx:0.6203, gy:0.4802, sector:'Orion Spur', distLy:'11', desc:'quiet red dwarf, temperate planet' },
    { name:'Wolf 1061', gx:0.6204, gy:0.4804, sector:'Orion Spur', distLy:'14.1', desc:'rocky planet near habitable zone' },
    { name:'Luyten\'s Star', gx:0.6203, gy:0.4801, sector:'Orion Spur', distLy:'12.2', desc:'super-Earth candidate in HZ' },
    { name:'Kepler-1649c', gx:0.660, gy:0.442, sector:'Perseus Arm', distLy:'301', desc:'most Earth-like exoplanet known' },
    { name:'Proxima Centauri', gx:0.6200, gy:0.4800, sector:'Orion Spur', distLy:'4.24', desc:'nearest star, confirmed rocky planet' },
  ];

  const signalPick = SIGNAL_CANDIDATES[Math.floor(Math.random() * SIGNAL_CANDIDATES.length)];
  const signal = { x: signalPick.gx, y: signalPick.gy, name: signalPick.name, sector: signalPick.sector, distLy: signalPick.distLy, desc: signalPick.desc };

  // ======== NASA EXOPLANET ARCHIVE API ========
  let nasaPlanets = null;
  let nasaSystems = {}; // hostname -> [planets]
  let nasaFetching = true;

  // Fallback exoplanets (real data, hardcoded)
  const FALLBACK_PLANETS = [
    { name:'Proxima Centauri b', host:'Proxima Centauri', dist:4.24, temp:234, radius:1.08, mass:1.27, year:2016, facility:'ESO La Silla', period:11.2 },
    { name:'TRAPPIST-1e', host:'TRAPPIST-1', dist:40.7, temp:251, radius:0.92, mass:0.69, year:2017, facility:'Spitzer', period:6.1 },
    { name:'TRAPPIST-1f', host:'TRAPPIST-1', dist:40.7, temp:219, radius:1.04, mass:1.04, year:2017, facility:'Spitzer', period:9.2 },
    { name:'TRAPPIST-1g', host:'TRAPPIST-1', dist:40.7, temp:199, radius:1.13, mass:1.32, year:2017, facility:'Spitzer', period:12.4 },
    { name:'Kepler-442b', host:'Kepler-442', dist:1206, temp:233, radius:1.34, mass:2.36, year:2015, facility:'Kepler', period:112.3 },
    { name:'Kepler-1649c', host:'Kepler-1649', dist:301, temp:234, radius:1.06, mass:1.2, year:2020, facility:'Kepler', period:19.5 },
    { name:'TOI-700 d', host:'TOI-700', dist:101.4, temp:269, radius:1.07, mass:1.72, year:2020, facility:'TESS', period:37.4 },
    { name:'K2-18 b', host:'K2-18', dist:124, temp:265, radius:2.61, mass:8.63, year:2015, facility:'K2', period:32.9 },
    { name:'LHS 1140 b', host:'LHS 1140', dist:49, temp:235, radius:1.73, mass:6.98, year:2017, facility:'MEarth', period:24.7 },
    { name:'GJ 667 Cc', host:'GJ 667 C', dist:23.6, temp:277, radius:1.54, mass:3.81, year:2011, facility:'HARPS', period:28.1 },
    { name:'Ross 128 b', host:'Ross 128', dist:11.0, temp:280, radius:1.10, mass:1.40, year:2017, facility:'HARPS', period:9.9 },
    { name:'Wolf 1061 c', host:'Wolf 1061', dist:14.1, temp:223, radius:1.66, mass:3.41, year:2015, facility:'HARPS', period:17.9 },
    { name:'Teegarden\'s Star b', host:'Teegarden\'s Star', dist:12.5, temp:264, radius:1.05, mass:1.05, year:2019, facility:'CARMENES', period:4.9 },
    { name:'GJ 1002 b', host:'GJ 1002', dist:15.8, temp:280, radius:1.03, mass:1.08, year:2022, facility:'ESPRESSO', period:10.3 },
    { name:'GJ 1002 c', host:'GJ 1002', dist:15.8, temp:226, radius:1.07, mass:1.36, year:2022, facility:'ESPRESSO', period:21.2 },
    { name:'Kepler-62f', host:'Kepler-62', dist:1200, temp:208, radius:1.41, mass:2.80, year:2013, facility:'Kepler', period:267.3 },
    { name:'HD 40307 g', host:'HD 40307', dist:42.0, temp:225, radius:2.40, mass:7.09, year:2012, facility:'HARPS', period:197.8 },
    { name:'Kepler-186f', host:'Kepler-186', dist:582, temp:188, radius:1.17, mass:1.71, year:2014, facility:'Kepler', period:129.9 },
    { name:'TOI-715 b', host:'TOI-715', dist:137, temp:234, radius:1.55, mass:3.02, year:2023, facility:'TESS', period:19.3 },
    { name:'LP 890-9 c', host:'LP 890-9', dist:105, temp:272, radius:1.37, mass:2.50, year:2022, facility:'SPECULOOS', period:8.5 },
  ];

  // Fetch real exoplanets from NASA (expanded query)
  (function fetchNASA() {
    const query = encodeURIComponent(
      'SELECT pl_name,hostname,sy_dist,pl_eqt,pl_rade,pl_bmasse,disc_year,disc_facility,pl_orbper,pl_orbeccen ' +
      'FROM ps ' +
      'WHERE pl_eqt BETWEEN 150 AND 350 AND sy_dist IS NOT NULL AND default_flag=1 ' +
      'ORDER BY sy_dist ASC'
    );
    const url = `https://exoplanetarchive.ipac.caltech.edu/TAP/sync?query=${query}&format=json`;
    fetch(url, { signal: AbortSignal.timeout(8000) })
      .then(r => r.json())
      .then(data => {
        if (Array.isArray(data) && data.length > 5) {
          nasaPlanets = data.map(p => ({
            name: p.pl_name || 'Unknown',
            host: p.hostname || 'Unknown',
            dist: p.sy_dist ? +(p.sy_dist * 3.262).toFixed(1) : null,
            temp: p.pl_eqt ? Math.round(p.pl_eqt) : null,
            radius: p.pl_rade ? +p.pl_rade.toFixed(2) : null,
            mass: p.pl_bmasse ? +p.pl_bmasse.toFixed(2) : null,
            year: p.disc_year || null,
            facility: p.disc_facility || null,
            period: p.pl_orbper ? +p.pl_orbper.toFixed(2) : null,
            ecc: p.pl_orbeccen ? +p.pl_orbeccen.toFixed(3) : null,
          }));
          // Group by host star
          nasaSystems = {};
          nasaPlanets.forEach(p => {
            if (!nasaSystems[p.host]) nasaSystems[p.host] = [];
            nasaSystems[p.host].push(p);
          });
        }
        nasaFetching = false;
      })
      .catch(() => { nasaFetching = false; });
  })();

  function getExoplanets() {
    return nasaPlanets || FALLBACK_PLANETS;
  }

  // Group fallback by host
  function getSystems() {
    if (Object.keys(nasaSystems).length > 0) return nasaSystems;
    const sys = {};
    FALLBACK_PLANETS.forEach(p => {
      if (!sys[p.host]) sys[p.host] = [];
      sys[p.host].push(p);
    });
    return sys;
  }

  // ======== EARTH SIMILARITY INDEX ========
  function calcESI(planet) {
    // ESI formula: geometric mean of similarity in radius, mass, temp, escape velocity
    // Simplified: uses radius, temp, mass relative to Earth
    const rE = 1, tE = 255, mE = 1; // Earth values
    const r = planet.radius || 1, t = planet.temp || 255, m = planet.mass || 1;
    const sr = 1 - Math.abs(r - rE) / (r + rE);
    const st = 1 - Math.abs(t - tE) / (t + tE);
    const sm = 1 - Math.abs(m - mE) / (m + mE);
    const esi = Math.pow(sr * st * sm, 1/3);
    return Math.max(0, Math.min(1, esi));
  }

  function esiClass(val) {
    if (val >= 0.8) return 'high';
    if (val >= 0.5) return 'medium';
    return 'low';
  }

  // ======== TRANSIT PREDICTION ========
  function nextTransit(period) {
    if (!period) return null;
    // Estimate next transit from now (simplified ‚Äî real ephemeris would need epoch)
    const now = Date.now();
    const periodMs = period * 24 * 3600 * 1000;
    // Fake a reference epoch near now for display purposes
    const epoch = now - (Math.random() * periodMs);
    const elapsed = now - epoch;
    const nextMs = epoch + Math.ceil(elapsed / periodMs) * periodMs;
    return new Date(nextMs);
  }

  // ======== ACTIVITY FEED ========
  const FEED_ITEMS = [
    'NASA confirms 5,799+ exoplanets discovered to date',
    'JWST detects atmospheric CO‚ÇÇ on K2-18 b ‚Äî possible biosignature',
    'SETI@home: 100 candidate signals under review with FAST telescope',
    'TESS mission extended through 2028 for continued planet hunting',
    'Unistellar Network: 15,000+ citizen science observations in 2025',
    'Proxima Centauri b: new radial velocity data refines mass estimate',
    'TRAPPIST-1 system: JWST rules out thick H‚ÇÇ atmosphere on several planets',
    'Breakthrough Listen scans 1 million+ stars ‚Äî no confirmed signals yet',
    'China\'s FAST telescope joins SETI search at unprecedented sensitivity',
    'TOI-700 e discovered ‚Äî fourth planet in habitable zone system',
    'LHS 1140 b: potential water world detected by JWST spectroscopy',
    'Allen Telescope Array upgraded with NVIDIA AI for real-time signal detection',
  ];
  let feedIndex = 0;

  // ======== GALAXY CANVAS ========
  const gC = document.getElementById('galaxyCanvas');
  const gX = gC.getContext('2d');
  let gStars = [];
  const cam = { x: 0, y: 0, zoom: 1, running: false };
  const EARTH = { x: 0.62, y: 0.48 };
  const trace = { progress: 0, active: false, pulseTime: 0, pulsing: false };

  function initGalaxy() {
    gC.width = window.innerWidth; gC.height = window.innerHeight;
    gStars = [];
    // Procedural spiral arms (galaxy structure)
    for (let arm = 0; arm < 4; arm++) {
      const ba = (arm / 4) * Math.PI * 2;
      for (let i = 0; i < 500; i++) {
        const d = (i / 500) * 0.42 + 0.02;
        const a = ba + d * 5.5 + (Math.random() - 0.5) * 0.6;
        const sp = (Math.random() - 0.5) * (0.03 + d * 0.12);
        gStars.push({ x: 0.5+Math.cos(a)*d+Math.cos(a+Math.PI/2)*sp, y: 0.5+Math.sin(a)*d*0.55+Math.sin(a+Math.PI/2)*sp*0.55, b: 0.15+Math.random()*0.55, s: 0.4+Math.random()*1.2, p: Math.random()*Math.PI*2, real: false });
      }
    }
    // Core glow
    for (let i = 0; i < 350; i++) {
      const a = Math.random()*Math.PI*2, d = Math.random()*0.08;
      gStars.push({ x: 0.5+Math.cos(a)*d, y: 0.5+Math.sin(a)*d*0.55, b: 0.3+Math.random()*0.7, s: 0.3+Math.random()*1.5, p: Math.random()*Math.PI*2, real: false });
    }
    // Scattered field
    for (let i = 0; i < 180; i++) gStars.push({ x: Math.random(), y: Math.random(), b: 0.1+Math.random()*0.2, s: 0.3+Math.random()*0.6, p: Math.random()*Math.PI*2, real: false });

    // Inject real cataloged stars
    for (const rs of REAL_STARS) {
      gStars.push({ x: rs.gx, y: rs.gy, b: 0.6+Math.random()*0.4, s: 1.0+Math.random()*0.8, p: Math.random()*Math.PI*2, real: true, label: rs.name, starType: rs.type, dist: rs.dist, desc: rs.desc });
    }
    // Inject signal candidates as clickable stars too
    for (const sc of SIGNAL_CANDIDATES) {
      // Don't duplicate if already a real star
      if (REAL_STARS.some(r => r.name === sc.name)) continue;
      gStars.push({ x: sc.gx, y: sc.gy, b: 0.5+Math.random()*0.4, s: 0.9+Math.random()*0.6, p: Math.random()*Math.PI*2, real: true, label: sc.name, starType: 'Exoplanet Host', dist: parseFloat(sc.distLy.replace(/,/g,'')), desc: sc.desc + '. Located in the ' + sc.sector + ' sector.' });
    }
  }

  function drawGalaxy(time) {
    if (!cam.running) return;
    const W = gC.width, H = gC.height, z = cam.zoom;
    gX.fillStyle = 'rgba(1,5,1,1)'; gX.fillRect(0,0,W,H);
    const csx = (0.5-cam.x)*z*W+W/2, csy = (0.5-cam.y)*z*H+H/2;
    const cg = gX.createRadialGradient(csx,csy,0,csx,csy,z*Math.min(W,H)*0.15);
    cg.addColorStop(0,'rgba(57,255,20,0.08)'); cg.addColorStop(0.4,'rgba(57,255,20,0.03)'); cg.addColorStop(1,'transparent');
    gX.fillStyle = cg; gX.fillRect(0,0,W,H);
    for (const st of gStars) {
      const sx = (st.x-cam.x)*z*W+W/2, sy = (st.y-cam.y)*z*H+H/2;
      if (sx<-10||sx>W+10||sy<-10||sy>H+10) continue;
      const tw = 0.6+0.4*Math.sin(time*0.001+st.p), al = st.b*tw, r = st.s*Math.min(z*0.6,3);
      // Real stars glow brighter
      if (st.real) {
        const rr = r * 1.3;
        gX.beginPath(); gX.arc(sx,sy,rr,0,Math.PI*2);
        gX.fillStyle=`rgba(57,255,20,${Math.min(1,al*1.3)})`; gX.fill();
        gX.beginPath(); gX.arc(sx,sy,rr*3,0,Math.PI*2);
        gX.fillStyle=`rgba(57,255,20,${al*0.12})`; gX.fill();
        // Show label when zoomed in enough
        if (z > 2.5) {
          gX.save(); gX.font='8px "Space Mono",monospace';
          gX.fillStyle=`rgba(57,255,20,${Math.min(0.6, (z-2.5)*0.3)})`;
          gX.textAlign='left';
          gX.fillText(st.label, sx+rr+4, sy+3);
          gX.restore();
        }
      } else {
        gX.beginPath(); gX.arc(sx,sy,r,0,Math.PI*2); gX.fillStyle=`rgba(57,255,20,${al})`; gX.fill();
        if (r>1.2) { gX.beginPath(); gX.arc(sx,sy,r*2.5,0,Math.PI*2); gX.fillStyle=`rgba(57,255,20,${al*0.08})`; gX.fill(); }
      }
    }
    gX.strokeStyle='rgba(57,255,20,0.015)'; gX.lineWidth=0.5;
    const gs=Math.max(40,60*z);
    for (let i=0;i<W;i+=gs){gX.beginPath();gX.moveTo(i,0);gX.lineTo(i,H);gX.stroke();}
    for (let i=0;i<H;i+=gs){gX.beginPath();gX.moveTo(0,i);gX.lineTo(W,i);gX.stroke();}
    const solX=(EARTH.x-cam.x)*z*W+W/2, solY=(EARTH.y-cam.y)*z*H+H/2;
    drawMarker(solX,solY,'EARTH',time,false);
    if (trace.active&&trace.progress>0) {
      const sigX=(signal.x-cam.x)*z*W+W/2, sigY=(signal.y-cam.y)*z*H+H/2;
      const eX=solX+(sigX-solX)*trace.progress, eY=solY+(sigY-solY)*trace.progress;
      gX.save(); gX.beginPath(); gX.moveTo(solX,solY); gX.lineTo(eX,eY);
      gX.strokeStyle='rgba(57,255,20,0.5)'; gX.lineWidth=1.5; gX.setLineDash([6,4]); gX.stroke(); gX.setLineDash([]);
      gX.beginPath(); gX.moveTo(solX,solY); gX.lineTo(eX,eY);
      gX.strokeStyle='rgba(57,255,20,0.04)'; gX.lineWidth=16; gX.stroke(); gX.restore();
      gX.beginPath(); gX.arc(eX,eY,3,0,Math.PI*2); gX.fillStyle='rgba(57,255,20,0.9)'; gX.fill();
      gX.beginPath(); gX.arc(eX,eY,10,0,Math.PI*2); gX.fillStyle='rgba(57,255,20,0.1)'; gX.fill();
      if (trace.progress>=1) {
        drawMarker(sigX,sigY,signal.name.toUpperCase(),time,true);
        if (trace.pulsing) {
          const el=(time-trace.pulseTime)/1000;
          for (let ring=0;ring<4;ring++) {
            const age=el-ring*0.3; if(age<0) continue;
            const rr=8+age*50, al=Math.max(0,0.5-age*0.25);
            gX.beginPath(); gX.arc(sigX,sigY,rr,0,Math.PI*2);
            gX.strokeStyle=`rgba(57,255,20,${al})`; gX.lineWidth=1.5; gX.stroke();
          }
        }
        // Position the HTML star label near the signal on screen
        galaxyStarLabel.style.left = (sigX + 20) + 'px';
        galaxyStarLabel.style.top = (sigY - 40) + 'px';
      }
    }
    requestAnimationFrame(drawGalaxy);
  }

  function drawMarker(x,y,label,time,isSig) {
    const pulse=0.5+0.5*Math.sin(time*0.003), al=isSig?0.9:0.7, sz=isSig?14:10;
    gX.strokeStyle=`rgba(57,255,20,${al})`; gX.lineWidth=1;
    gX.beginPath();
    gX.moveTo(x-sz,y); gX.lineTo(x-4,y); gX.moveTo(x+4,y); gX.lineTo(x+sz,y);
    gX.moveTo(x,y-sz); gX.lineTo(x,y-4); gX.moveTo(x,y+4); gX.lineTo(x,y+sz);
    gX.stroke();
    gX.beginPath(); gX.arc(x,y,isSig?3:2,0,Math.PI*2); gX.fillStyle=`rgba(57,255,20,${al})`; gX.fill();
    gX.beginPath(); gX.arc(x,y,(isSig?20:12)*pulse,0,Math.PI*2); gX.fillStyle=`rgba(57,255,20,${isSig?0.06:0.04})`; gX.fill();
    gX.save(); gX.font=isSig?'bold 10px "Space Mono",monospace':'9px "Space Mono",monospace';
    gX.fillStyle=`rgba(57,255,20,${al})`; gX.textAlign='left';
    gX.shadowColor='rgba(57,255,20,0.5)'; gX.shadowBlur=isSig?12:6;
    gX.fillText(label,x+sz+6,y+4); gX.restore();
  }

  function animateTo(obj,props,dur) {
    return new Promise(res => {
      const start={}, t0=performance.now();
      for (const k in props) start[k]=obj[k];
      (function tick(now) {
        let t=Math.min((now-t0)/dur,1);
        t=t<0.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;
        for (const k in props) obj[k]=start[k]+(props[k]-start[k])*t;
        if (t<1) requestAnimationFrame(tick); else res();
      })(performance.now());
    });
  }

  // ======== MAIN SEQUENCE ========
  async function runSequence() {
    const d = 110;

    // ---- BOOT PHASE ----
    await addLine('$ et_signal_relay v4.2.0', 'green');
    await addLine('$ copyright (c) 2025 ET Protocol Labs', 'dim', d);
    await addLine('', '', d*0.3);
    setProg(2);

    await addLine('[boot] loading kernel modules...', 'dim', d);
    await wait(200);
    await addLine('[boot]   mod_antenna_array.ko        loaded', 'dim', d*0.6);
    await addLine('[boot]   mod_quantum_decoder.ko      loaded', 'dim', d*0.6);
    await addLine('[boot]   mod_signal_processor.ko     loaded', 'dim', d*0.6);
    await addLine('[boot]   mod_solana_bridge.ko        loaded', 'dim', d*0.6);
    setProg(7);

    await addLine('[boot] mounting /dev/solana...', 'dim', d);
    await wait(300);
    await addLine('[boot]   rpc endpoint: mainnet-beta    OK', 'dim', d*0.5);
    await addLine('[boot]   block height: 298,441,207     OK', 'dim', d*0.5);
    setProg(11);

    await addLine('[boot] initializing cryptographic engines...', 'dim', d);
    await addLine('[boot]   ed25519 signature engine      OK', 'dim', d*0.5);
    await addLine('[boot]   sha256 hash pipeline          OK', 'dim', d*0.5);
    await addLine('[boot]   aes-256-gcm cipher suite      OK', 'dim', d*0.5);
    setProg(15);

    await addLine('', '', d*0.3);
    await addLine('[sys]  allocating deep-space antenna array', '', d);
    await wait(250);
    await addLine('[sys]    dish 01 .... online   ‚úì', 'green', d*0.6);
    await addLine('[sys]    dish 02 .... online   ‚úì', 'green', d*0.6);
    await addLine('[sys]    dish 03 .... online   ‚úì', 'green', d*0.6);
    await addLine('[sys]    dish 04 .... online   ‚úì', 'green', d*0.6);
    await addLine('[sys]    dish 05 .... standby  ‚óã', 'dim', d*0.6);
    setProg(21);

    await addLine('[sys]  frequency locked: 1420.405 MHz (hydrogen line)', '', d);
    await addLine('[sys]  secondary: 4462.336 MHz (deuterium)', 'dim', d*0.6);
    await addLine('[sys]  bandwidth: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà MAXIMUM', 'green', d);
    await addLine('[sys]  sensitivity: -260 dBm', 'dim', d*0.5);
    setProg(26);

    // ---- SELF-TEST ----
    await addLine('', '', d*0.3);
    await addLine('$ running pre-flight diagnostics...', 'green', d);
    await wait(200);
    await addLine('[diag] antenna alignment .............. PASS', 'dim', d*0.7);
    await addLine('[diag] signal-to-noise ratio .......... PASS', 'dim', d*0.7);
    await addLine('[diag] temporal sync (UTC) ............ PASS', 'dim', d*0.7);
    await addLine('[diag] quantum decoherence check ...... PASS', 'dim', d*0.7);
    await addLine('[diag] solana RPC heartbeat ........... PASS', 'dim', d*0.7);
    await addLine('[diag] all systems nominal', 'success', d*0.5);
    setProg(34);

    // ---- SCANNING (real exoplanet data) ----
    await addLine('', '', d*0.3);
    await addLine('$ initiating deep-space scan...', 'green', d);
    const planets = getExoplanets();
    const isLive = nasaPlanets !== null;
    await addLine(`[scan] source: ${isLive ? 'NASA Exoplanet Archive (live)' : 'local exoplanet catalog'}`, isLive ? 'green' : 'dim', d);
    await addLine(`[scan] filter: habitable zone, 0.5-2.5 R‚äï, 170-320K`, 'dim', d*0.5);
    await addLine(`[scan] results: ${planets.length} candidates`, '', d*0.5);
    await wait(200);

    const showCount = Math.min(planets.length, 12);
    for (let i = 0; i < showCount; i++) {
      const p = planets[i];
      const nm = (p.name || 'Unknown').substring(0, 20).padEnd(20);
      const ds = p.dist ? `${p.dist} ly`.padStart(11) : '     ‚Äî ly';
      const tp = p.temp ? `${p.temp}K`.padStart(5) : '   ‚ÄîK';
      const rd = p.radius ? `${p.radius}R‚äï`.padStart(7) : '     ‚ÄîR‚äï';
      await addLine(`[scan] ${nm} ${ds} ${tp} ${rd} ‚Üí no signal`, 'dim', d*0.45);
      setProg(34 + (i+1) * (21 / showCount));
    }
    await addLine(`[scan] ${planets.length}/${planets.length} habitable zone exoplanets scanned`, 'green', d*0.5);
    setProg(55);

    // ---- TRANSMITTING ----
    await addLine('', '', d*0.3);
    await addLine('$ encoding outbound transmission...', 'green', d);
    await addLine('[tx]   payload: "ET PHONE HOME"', '', d*0.8);
    await addLine('[tx]   packet size: 42,069 bytes', 'dim', d*0.5);
    await addLine('[tx]   encryption: solana-ed25519', 'dim', d*0.5);
    await addLine('[tx]   error correction: reed-solomon', 'dim', d*0.5);
    setProg(59);
    await addLine('[tx]   broadcasting on all frequencies...', 'green', d);
    await wait(300);

    // ---- PINGING ----
    await addLine('', '', d*0.3);
    await addLine('$ pinging relay stations...', 'green', d);
    const pings = [
      ['Alpha Centauri Hub','4.37 ly','timeout'],
      ['Vega Relay','25.0 ly','no response'],
      ['Sirius Gateway','8.6 ly','no response'],
      ['Andromeda Relay','2.537M ly','no response'],
      ['Orion Arm Node','1,344 ly','no response'],
      ['Sagittarius Gate','26,000 ly','no response'],
    ];
    for (let i = 0; i < pings.length; i++) {
      const [t,ds,s] = pings[i];
      await addLine(`[ping] ${t.padEnd(22)} ${ds.padStart(10)} ‚Üí ${s}`, 'dim', d*0.8);
      setProg(60 + (i+1)*2);
    }
    setProg(73);

    // ---- SIGNAL DETECTED ----
    await addLine('', '', d*0.3);
    await wait(400);
    await addLine('[rx]   ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë', 'dim', d);
    await wait(300);
    sfxWarn();
    await addLine('[rx]   ‚ñà‚ñà ANOMALOUS SIGNAL DETECTED ‚ñà‚ñà', 'warn', d);
    await wait(200);
    await addLine('[rx]   ‚ñà‚ñà ANOMALOUS SIGNAL DETECTED ‚ñà‚ñà', 'warn', d*0.3);
    setProg(76);
    await addLine('[rx]   ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë', 'dim', d*0.5);
    await wait(300);

    await addLine('[rx]   analyzing waveform pattern...', '', d);
    await wait(350);
    await addLine('[rx]   spectral class: non-terrestrial', 'warn', d*0.8);
    await addLine('[rx]   modulation: unknown protocol', 'warn', d*0.6);
    await addLine(`[rx]   estimated origin: ${signal.sector}`, 'warn', d*0.6);
    await addLine(`[rx]   note: ${signal.desc}`, 'warn', d*0.6);
    setProg(80);

    await addLine('', '', d*0.3);
    await addLine('[rx]   attempting decode...', 'green', d);
    await wait(500);
    await addLine('[rx]   ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 50%', 'dim', d*0.5);
    await wait(300);
    await addLine('[rx]   ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë 75%', 'dim', d*0.4);
    await wait(200);
    await addLine('[rx]   ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì 100%', 'green', d*0.3);
    setProg(84);

    await addLine('[rx]   decode successful.', 'success', d*0.8);
    await addLine(`[rx]   source star: ${signal.name}`, 'success', d*0.5);
    await addLine(`[rx]   distance: ${signal.distLy} light-years`, 'green', d*0.5);
    setProg(87);

    await addLine('', '', d*0.3);
    await addLine('[sys]  triangulating coordinates...', 'green', d);
    await wait(400);
    await addLine('[sys]  lock confirmed. opening galactic map...', 'success', d);
    setProg(90);

    await wait(600);

    // ======== GALAXY PHASE ========
    initGalaxy();
    cam.running = true;
    cam.x = EARTH.x; cam.y = EARTH.y; cam.zoom = 2.8;
    terminalPhase.classList.add('shrink');
    await wait(400);
    galaxyPhase.classList.add('active');
    requestAnimationFrame(drawGalaxy);
    await wait(600);
    galaxyHud.classList.add('show');
    galaxyHudRight.classList.add('show');

    // Zoom out to full galaxy
    await animateTo(cam, { x: 0.5, y: 0.5, zoom: 1.05 }, 2800);
    await wait(500);

    // Trace signal
    trace.active = true;
    galaxyStatus.innerHTML = 'status: <span style="color:#ffaa00">TRACING SIGNAL...</span>';
    await animateTo(trace, { progress: 1 }, 2400);

    // Signal found!
    trace.pulsing = true;
    trace.pulseTime = performance.now();
    galaxyStatus.innerHTML = 'status: <span style="color:#ffaa00">‚ö† SIGNAL LOCKED</span>';
    galaxyDist.innerHTML = `distance: <span>${signal.distLy} ly</span>`;
    galaxyCoord.innerHTML = `sector: <span>${signal.sector}</span>`;
    galaxyStar.innerHTML = `star: <span>${signal.name}</span>`;
    await wait(800);

    // Zoom into signal
    await animateTo(cam, { x: signal.x, y: signal.y, zoom: 5 }, 3000);
    await wait(300);

    // Show star name label on canvas
    galaxyStarLabel.textContent = '‚òÖ ' + signal.name;
    galaxyStarLabel.classList.add('show');

    galaxyStatus.innerHTML = 'status: <span style="color:var(--green);font-weight:700">‚úì CONTACT ESTABLISHED</span>';
    galaxyFinal.classList.add('show');
    await wait(3000);

    // Transition: stop preloader galaxy, show main page
    cam.running = false;
    preloader.classList.add('done');
    pageWrapper.classList.remove('hidden');
  }

  // ======== INTERACTIVE GALAXY (BACKROOM OVERLAY) ========
  let backroomInitialized = false;

  window.openBackroom = function() {
    const overlay = document.getElementById('backroomOverlay');
    overlay.classList.add('open');
    document.body.classList.add('backroom-active');
    if (!backroomInitialized) {
      backroomInitialized = true;
      initInteractiveGalaxy();
    }
  };

  window.closeBackroom = function() {
    const overlay = document.getElementById('backroomOverlay');
    overlay.classList.remove('open');
    document.body.classList.remove('backroom-active');
  };

  function initInteractiveGalaxy() {
    const sC = document.getElementById('galaxySectionCanvas');
    const sX = sC.getContext('2d');
    const section = document.getElementById('backroomOverlay');
    const statusEl = document.getElementById('galaxySectionStatus');
    const hintEl = document.getElementById('galaxyHint');

    // Interactive camera (separate from preloader cam)
    const iCam = { x: 0.5, y: 0.5, zoom: 1.1 };
    let dragging = false, dragStartX = 0, dragStartY = 0, camStartX = 0, camStartY = 0;
    let selectedStar = null;
    let hintTimer = null;
    let isVisible = false;

    function resizeSection() {
      sC.width = window.innerWidth;
      sC.height = window.innerHeight;
    }
    resizeSection();

    // Reuse existing gStars data (already generated during preloader)
    function drawInteractive(time) {
      if (!isVisible) { requestAnimationFrame(drawInteractive); return; }
      const W = sC.width, H = sC.height, z = iCam.zoom;

      sX.fillStyle = 'rgba(1,5,1,1)';
      sX.fillRect(0, 0, W, H);

      // Core glow
      const csx = (0.5 - iCam.x) * z * W + W / 2;
      const csy = (0.5 - iCam.y) * z * H + H / 2;
      const cg = sX.createRadialGradient(csx, csy, 0, csx, csy, z * Math.min(W, H) * 0.15);
      cg.addColorStop(0, 'rgba(57,255,20,0.08)');
      cg.addColorStop(0.4, 'rgba(57,255,20,0.03)');
      cg.addColorStop(1, 'transparent');
      sX.fillStyle = cg;
      sX.fillRect(0, 0, W, H);

      // Stars
      for (const st of gStars) {
        const sx = (st.x - iCam.x) * z * W + W / 2;
        const sy = (st.y - iCam.y) * z * H + H / 2;
        if (sx < -10 || sx > W + 10 || sy < -10 || sy > H + 10) continue;

        const tw = 0.6 + 0.4 * Math.sin(time * 0.001 + st.p);
        const al = st.b * tw;
        const r = st.s * Math.min(z * 0.6, 3);

        if (st.real) {
          const rr = r * 1.4;
          const isSelected = selectedStar === st;
          const glowMult = isSelected ? 2.5 : 1;

          // Clickable pulse ‚Äî gentle breathing for real stars
          const clickPulse = 1 + 0.2 * Math.sin(time * 0.003 + st.p);

          sX.beginPath();
          sX.arc(sx, sy, rr * clickPulse, 0, Math.PI * 2);
          sX.fillStyle = `rgba(57,255,20,${Math.min(1, al * 1.4 * glowMult)})`;
          sX.fill();

          // Outer glow
          sX.beginPath();
          sX.arc(sx, sy, rr * 3 * clickPulse * glowMult, 0, Math.PI * 2);
          sX.fillStyle = `rgba(57,255,20,${al * 0.12 * glowMult})`;
          sX.fill();

          // Selection ring
          if (isSelected) {
            const ringPulse = 1 + 0.3 * Math.sin(time * 0.005);
            sX.beginPath();
            sX.arc(sx, sy, 12 * ringPulse, 0, Math.PI * 2);
            sX.strokeStyle = `rgba(57,255,20,${0.6 * ringPulse})`;
            sX.lineWidth = 1;
            sX.stroke();
            // Crosshair
            sX.beginPath();
            sX.moveTo(sx - 18, sy); sX.lineTo(sx - 8, sy);
            sX.moveTo(sx + 8, sy); sX.lineTo(sx + 18, sy);
            sX.moveTo(sx, sy - 18); sX.lineTo(sx, sy - 8);
            sX.moveTo(sx, sy + 8); sX.lineTo(sx, sy + 18);
            sX.strokeStyle = 'rgba(57,255,20,0.5)';
            sX.lineWidth = 1;
            sX.stroke();
          }

          // Labels at zoom > 1.8
          if (z > 1.8) {
            sX.save();
            sX.font = isSelected ? 'bold 10px "Space Mono",monospace' : '8px "Space Mono",monospace';
            sX.fillStyle = `rgba(57,255,20,${Math.min(0.7, (z - 1.8) * 0.5)})`;
            sX.textAlign = 'left';
            sX.fillText(st.label, sx + rr * clickPulse + 6, sy + 3);
            sX.restore();
          }
        } else {
          sX.beginPath();
          sX.arc(sx, sy, r, 0, Math.PI * 2);
          sX.fillStyle = `rgba(57,255,20,${al})`;
          sX.fill();
          if (r > 1.2) {
            sX.beginPath();
            sX.arc(sx, sy, r * 2.5, 0, Math.PI * 2);
            sX.fillStyle = `rgba(57,255,20,${al * 0.08})`;
            sX.fill();
          }
        }
      }

      // Grid
      sX.strokeStyle = 'rgba(57,255,20,0.015)';
      sX.lineWidth = 0.5;
      const gs = Math.max(40, 60 * z);
      for (let i = 0; i < W; i += gs) { sX.beginPath(); sX.moveTo(i, 0); sX.lineTo(i, H); sX.stroke(); }
      for (let i = 0; i < H; i += gs) { sX.beginPath(); sX.moveTo(0, i); sX.lineTo(W, i); sX.stroke(); }

      // EARTH marker
      const solX = (EARTH.x - iCam.x) * z * W + W / 2;
      const solY = (EARTH.y - iCam.y) * z * H + H / 2;
      drawSectionMarker(sX, solX, solY, 'EARTH', time, false);

      // Signal trace + marker (persistent from preloader)
      if (trace.active) {
        const sigX = (signal.x - iCam.x) * z * W + W / 2;
        const sigY = (signal.y - iCam.y) * z * H + H / 2;
        sX.save();
        sX.beginPath(); sX.moveTo(solX, solY); sX.lineTo(sigX, sigY);
        sX.strokeStyle = 'rgba(57,255,20,0.3)'; sX.lineWidth = 1; sX.setLineDash([6, 4]); sX.stroke(); sX.setLineDash([]);
        sX.beginPath(); sX.moveTo(solX, solY); sX.lineTo(sigX, sigY);
        sX.strokeStyle = 'rgba(57,255,20,0.02)'; sX.lineWidth = 12; sX.stroke();
        sX.restore();
        drawSectionMarker(sX, sigX, sigY, signal.name.toUpperCase(), time, true);
      }

      // Update zoom display
      statusEl.innerHTML = `zoom: <span>${z.toFixed(1)}x</span>`;

      requestAnimationFrame(drawInteractive);
    }

    function drawSectionMarker(ctx, x, y, label, time, isSig) {
      const pulse = 0.5 + 0.5 * Math.sin(time * 0.003);
      const al = isSig ? 0.9 : 0.7;
      const sz = isSig ? 12 : 8;
      ctx.strokeStyle = `rgba(57,255,20,${al})`;
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(x - sz, y); ctx.lineTo(x - 3, y); ctx.moveTo(x + 3, y); ctx.lineTo(x + sz, y);
      ctx.moveTo(x, y - sz); ctx.lineTo(x, y - 3); ctx.moveTo(x, y + 3); ctx.lineTo(x, y + sz);
      ctx.stroke();
      ctx.beginPath(); ctx.arc(x, y, isSig ? 2.5 : 2, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(57,255,20,${al})`; ctx.fill();
      ctx.beginPath(); ctx.arc(x, y, (isSig ? 16 : 10) * pulse, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(57,255,20,${isSig ? 0.05 : 0.03})`; ctx.fill();
      ctx.save();
      ctx.font = isSig ? 'bold 9px "Space Mono",monospace' : '8px "Space Mono",monospace';
      ctx.fillStyle = `rgba(57,255,20,${al})`;
      ctx.textAlign = 'left';
      ctx.shadowColor = 'rgba(57,255,20,0.4)'; ctx.shadowBlur = isSig ? 10 : 4;
      ctx.fillText(label, x + sz + 5, y + 3);
      ctx.restore();
    }

    // --- Interaction: Pan ---
    sC.addEventListener('mousedown', e => {
      dragging = true;
      dragStartX = e.clientX; dragStartY = e.clientY;
      camStartX = iCam.x; camStartY = iCam.y;
      hintEl.classList.add('hidden');
    });
    window.addEventListener('mousemove', e => {
      if (!dragging) return;
      const dx = (e.clientX - dragStartX) / (sC.width * iCam.zoom);
      const dy = (e.clientY - dragStartY) / (sC.height * iCam.zoom);
      iCam.x = camStartX - dx;
      iCam.y = camStartY - dy;
    });
    window.addEventListener('mouseup', () => { dragging = false; });

    // --- Touch pan ---
    let touchStartX = 0, touchStartY = 0, touchCamX = 0, touchCamY = 0;
    let lastPinchDist = 0;
    sC.addEventListener('touchstart', e => {
      if (e.touches.length === 1) {
        dragging = true;
        touchStartX = e.touches[0].clientX; touchStartY = e.touches[0].clientY;
        touchCamX = iCam.x; touchCamY = iCam.y;
        hintEl.classList.add('hidden');
      } else if (e.touches.length === 2) {
        lastPinchDist = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
      }
      e.preventDefault();
    }, { passive: false });
    sC.addEventListener('touchmove', e => {
      if (e.touches.length === 1 && dragging) {
        const dx = (e.touches[0].clientX - touchStartX) / (sC.width * iCam.zoom);
        const dy = (e.touches[0].clientY - touchStartY) / (sC.height * iCam.zoom);
        iCam.x = touchCamX - dx;
        iCam.y = touchCamY - dy;
      } else if (e.touches.length === 2) {
        const dist = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
        const scale = dist / lastPinchDist;
        iCam.zoom = Math.max(0.5, Math.min(12, iCam.zoom * scale));
        lastPinchDist = dist;
      }
      e.preventDefault();
    }, { passive: false });
    sC.addEventListener('touchend', () => { dragging = false; });

    // --- Zoom: scroll wheel ---
    sC.addEventListener('wheel', e => {
      e.preventDefault();
      const factor = e.deltaY > 0 ? 0.9 : 1.1;
      iCam.zoom = Math.max(0.5, Math.min(12, iCam.zoom * factor));
      hintEl.classList.add('hidden');
    }, { passive: false });

    // --- Zoom buttons ---
    document.getElementById('zoomIn').addEventListener('click', () => {
      iCam.zoom = Math.min(12, iCam.zoom * 1.4);
    });
    document.getElementById('zoomOut').addEventListener('click', () => {
      iCam.zoom = Math.max(0.5, iCam.zoom * 0.7);
    });
    document.getElementById('zoomReset').addEventListener('click', () => {
      iCam.x = 0.5; iCam.y = 0.5; iCam.zoom = 1.1;
      selectedStar = null;
      document.getElementById('brSidebar').classList.remove('open');
    });

    // --- Click: find nearest real star, open sidebar ---
    sC.addEventListener('click', e => {
      if (Math.abs(e.clientX - dragStartX) > 5 || Math.abs(e.clientY - dragStartY) > 5) return;

      const rect = sC.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
      const W = sC.width, H = sC.height, z = iCam.zoom;

      let closest = null, closestDist = Infinity;
      for (const st of gStars) {
        if (!st.real) continue;
        const sx = (st.x - iCam.x) * z * W + W / 2;
        const sy = (st.y - iCam.y) * z * H + H / 2;
        const d = Math.hypot(sx - mx, sy - my);
        const hitRadius = Math.max(15, 8 * z);
        if (d < hitRadius && d < closestDist) { closest = st; closestDist = d; }
      }

      const sidebar = document.getElementById('brSidebar');
      if (closest) {
        selectedStar = closest;
        populateSidebar(closest);
        sidebar.classList.add('open');
      } else {
        selectedStar = null;
        sidebar.classList.remove('open');
      }
    });

    // Close sidebar
    document.getElementById('brSidebarClose').addEventListener('click', e => {
      e.stopPropagation();
      selectedStar = null;
      document.getElementById('brSidebar').classList.remove('open');
    });

    // Populate sidebar with star + planet data
    function populateSidebar(star) {
      document.getElementById('brStarName').textContent = star.label;

      let metaHTML = `type: <span>${star.starType || '‚Äî'}</span><br>`;
      metaHTML += `distance: <span>${star.dist ? star.dist.toLocaleString() + ' light-years' : 'local'}</span>`;
      if (star.label === signal.name) {
        metaHTML += `<br>status: <span style="color:var(--green)">‚ö† SIGNAL SOURCE</span>`;
      }
      document.getElementById('brStarMeta').innerHTML = metaHTML;
      document.getElementById('brStarDesc').textContent = star.desc || '';

      // Find planets for this star
      const systems = getSystems();
      // Match star label to host names (partial match)
      let starPlanets = [];
      const cleanName = star.label.replace(/\s*\(.*\)/, '').trim();
      for (const host in systems) {
        if (host === cleanName || cleanName.includes(host) || host.includes(cleanName)) {
          starPlanets = starPlanets.concat(systems[host]);
        }
      }

      const planetsSection = document.getElementById('brPlanetsSection');
      const planetsContainer = document.getElementById('brPlanets');
      const transitSection = document.getElementById('brTransitSection');
      const transitContainer = document.getElementById('brTransits');

      if (starPlanets.length > 0) {
        planetsSection.style.display = 'block';
        planetsContainer.innerHTML = '';

        starPlanets.forEach(p => {
          const esi = calcESI(p);
          const esiPct = Math.round(esi * 100);
          const esiCls = esiClass(esi);

          const card = document.createElement('div');
          card.className = 'br-planet-card';
          card.innerHTML = `
            <div class="br-planet-name">${p.name}</div>
            <div class="br-planet-stats">
              <div>radius: <span>${p.radius ? p.radius + ' R‚äï' : '‚Äî'}</span></div>
              <div>mass: <span>${p.mass ? p.mass + ' M‚äï' : '‚Äî'}</span></div>
              <div>temp: <span>${p.temp ? p.temp + ' K' : '‚Äî'}</span></div>
              <div>period: <span>${p.period ? p.period + ' days' : '‚Äî'}</span></div>
              <div>discovered: <span>${p.year || '‚Äî'}</span></div>
              <div>facility: <span>${p.facility || '‚Äî'}</span></div>
            </div>
            <div class="br-esi">
              <div class="br-esi-label">earth similarity index <span class="${esiCls === 'high' ? '' : ''}" style="color:${esiCls === 'high' ? 'var(--green)' : esiCls === 'medium' ? '#ffaa00' : '#ff5533'}">${esiPct}%</span></div>
              <div class="br-esi-bar"><div class="br-esi-fill ${esiCls}" style="width:${esiPct}%"></div></div>
            </div>
          `;
          planetsContainer.appendChild(card);
        });

        // Transit predictions
        const transits = starPlanets
          .filter(p => p.period)
          .map(p => ({ name: p.name, next: nextTransit(p.period), period: p.period }))
          .sort((a, b) => a.next - b.next)
          .slice(0, 3);

        if (transits.length > 0) {
          transitSection.style.display = 'block';
          transitContainer.innerHTML = '';
          transits.forEach(t => {
            const div = document.createElement('div');
            div.className = 'br-transit-item';
            const dateStr = t.next.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            const timeStr = t.next.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            div.innerHTML = `<span class="transit-planet">${t.name}</span> ‚Äî next transit est. <span class="transit-time">${dateStr} ${timeStr}</span><br>period: ${t.period} days`;
            transitContainer.appendChild(div);
          });
        } else {
          transitSection.style.display = 'none';
        }
      } else {
        planetsSection.style.display = 'none';
        transitSection.style.display = 'none';
      }
    }

    // Update mission control bar
    function updateBar() {
      const planets = getExoplanets();
      document.getElementById('brBarPlanets').textContent = planets.length;
      document.getElementById('brBarStars').textContent = gStars.filter(s => s.real).length;
      document.getElementById('brBarSource').textContent = nasaPlanets ? 'NASA LIVE' : 'LOCAL CATALOG';

      // Rotating feed
      document.getElementById('brBarFeed').textContent = FEED_ITEMS[feedIndex % FEED_ITEMS.length];
      feedIndex++;
    }
    updateBar();
    setInterval(updateBar, 6000);

    // Visibility based on overlay open state
    function checkVisible() {
      isVisible = section.classList.contains('open');
    }
    const mo = new MutationObserver(checkVisible);
    mo.observe(section, { attributes: true, attributeFilter: ['class'] });

    window.addEventListener('resize', resizeSection);
    isVisible = true;
    requestAnimationFrame(drawInteractive);
  }

  // Auto-start sequence. Audio inits on first user interaction (browser requirement).
  function tryInitAudio() {
    if (!audioCtx) { initAudio(); }
    document.removeEventListener('click', tryInitAudio);
    document.removeEventListener('touchstart', tryInitAudio);
    document.removeEventListener('keydown', tryInitAudio);
  }
  document.addEventListener('click', tryInitAudio, { once: false });
  document.addEventListener('touchstart', tryInitAudio, { once: false });
  document.addEventListener('keydown', tryInitAudio, { once: false });

  if (document.fonts && document.fonts.ready) {
    document.fonts.ready.then(() => setTimeout(runSequence, 250));
  } else { setTimeout(runSequence, 500); }
})();
</script>

<script>
  const canvas = document.getElementById('starfield');
  const ctx = canvas.getContext('2d');
  let stars = [];
  function initStars() {
    canvas.width = window.innerWidth; canvas.height = window.innerHeight; stars = [];
    const count = Math.floor((canvas.width*canvas.height)/3000);
    for (let i = 0; i < count; i++) stars.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: Math.random()*1.5+0.3, speed: Math.random()*0.005+0.002, phase: Math.random()*Math.PI*2 });
  }
  function drawStars(time) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    stars.forEach(s => {
      const a = 0.3 + 0.7*Math.abs(Math.sin(time*s.speed+s.phase));
      ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI*2); ctx.fillStyle = `rgba(57,255,20,${a*0.5})`; ctx.fill();
      if (s.r > 1) { ctx.beginPath(); ctx.arc(s.x, s.y, s.r*3, 0, Math.PI*2); ctx.fillStyle = `rgba(57,255,20,${a*0.05})`; ctx.fill(); }
    });
    requestAnimationFrame(drawStars);
  }
  initStars(); requestAnimationFrame(drawStars); window.addEventListener('resize', initStars);

  // Backroom open/close
  document.getElementById('enterBackroom').addEventListener('click', e => {
    e.preventDefault();
    openBackroom();
  });
  document.getElementById('backroomBack').addEventListener('click', () => {
    closeBackroom();
  });
  // ESC key closes backroom, onboarding, or rewards
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
      if (document.getElementById('rewardsOverlay').classList.contains('open')) {
        closeRewards();
      } else if (document.getElementById('onboardOverlay').classList.contains('open')) {
        closeOnboarding();
      } else if (document.getElementById('backroomOverlay').classList.contains('open')) {
        closeBackroom();
      }
    }
  });
  // Nav backroom link
  document.querySelectorAll('a[href="#backroom"]').forEach(a => {
    a.addEventListener('click', e => { e.preventDefault(); openBackroom(); });
  });

  // Onboarding open/close
  window.openOnboarding = function() {
    document.getElementById('onboardOverlay').classList.add('open');
    document.body.classList.add('onboard-active');
  };
  window.closeOnboarding = function() {
    document.getElementById('onboardOverlay').classList.remove('open');
    document.body.classList.remove('onboard-active');
  };
  document.getElementById('onboardClose').addEventListener('click', closeOnboarding);

  // Rewards open/close
  window.openRewards = function() {
    document.getElementById('rewardsOverlay').classList.add('open');
    document.body.classList.add('rewards-active');
  };
  window.closeRewards = function() {
    document.getElementById('rewardsOverlay').classList.remove('open');
    document.body.classList.remove('rewards-active');
  };
  document.getElementById('rewardsClose').addEventListener('click', closeRewards);

  // Rewards registration (localStorage for now ‚Äî backend later)
  const REWARDS_KEY = 'et_rewards_registrations';
  function getRegistrations() {
    try { return JSON.parse(localStorage.getItem(REWARDS_KEY) || '[]'); } catch(e) { return []; }
  }
  function saveRegistration(wallet, boinc) {
    const regs = getRegistrations();
    const existing = regs.findIndex(r => r.wallet === wallet);
    if (existing >= 0) { regs[existing].boinc = boinc; }
    else { regs.push({ wallet, boinc, credits: 0, registered: Date.now() }); }
    localStorage.setItem(REWARDS_KEY, JSON.stringify(regs));
    return regs;
  }

  // Registration handler
  document.getElementById('rewardsRegister').addEventListener('click', function() {
    const wallet = document.getElementById('rewardsWallet').value.trim();
    const boinc = document.getElementById('rewardsBoinc').value.trim();
    const status = document.getElementById('rewardsStatus');
    if (!wallet || wallet.length < 32 || wallet.length > 44) {
      status.style.color = '#ff4444';
      status.textContent = 'Enter a valid Solana wallet address (32‚Äì44 chars)';
      return;
    }
    if (!boinc || boinc.length < 2) {
      status.style.color = '#ff4444';
      status.textContent = 'Enter your Einstein@home username';
      return;
    }
    saveRegistration(wallet, boinc);
    status.style.color = 'var(--green)';
    status.textContent = '‚úì Registered! Your rewards will accrue as you earn BOINC credits.';
    renderLeaderboard();
    document.getElementById('rewardsWallet').value = '';
    document.getElementById('rewardsBoinc').value = '';
  });

  // Render leaderboard from localStorage
  function renderLeaderboard() {
    const regs = getRegistrations();
    const container = document.getElementById('rewardsLeaderboard');
    const membersEl = document.getElementById('rewardsPoolMembers');
    membersEl.textContent = regs.length;
    if (regs.length === 0) {
      container.innerHTML = '<div class="rewards-lb-empty">No contributors yet.<br>Be the first to register and start earning.</div>';
      return;
    }
    // Sort by credits (all 0 for now ‚Äî backend will populate)
    const sorted = [...regs].sort((a,b) => (b.credits||0) - (a.credits||0));
    const totalCredits = sorted.reduce((sum,r) => sum + (r.credits||0), 0);
    document.getElementById('rewardsPoolCredits').textContent = totalCredits.toLocaleString();
    container.innerHTML = sorted.map((r, i) => {
      const share = totalCredits > 0 ? ((r.credits||0) / totalCredits * 100).toFixed(1) + '%' : '‚Äî';
      const shortWallet = r.wallet.slice(0,4) + '...' + r.wallet.slice(-4);
      return `<div class="rewards-lb-row">
        <span class="rewards-lb-rank">${i+1}</span>
        <span class="rewards-lb-user" title="${r.boinc} ‚Äî ${r.wallet}">${r.boinc} <span style="color:var(--text-dim);font-size:8px;">(${shortWallet})</span></span>
        <span class="rewards-lb-credits">${(r.credits||0).toLocaleString()}</span>
        <span class="rewards-lb-share">${share}</span>
      </div>`;
    }).join('');
  }

  // Update ESC handler to also close rewards
  renderLeaderboard();

  function copyCA() {
    navigator.clipboard.writeText('A1NZ4kjhJxdmMMHQTGF8HaU7k6JCh5gSyHEeAKE3xRMF').then(() => {
      const t = document.getElementById('copyToast'); t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2000);
    });
  }
  const revealEls = document.querySelectorAll('.reveal');
  const observer = new IntersectionObserver(entries => { entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); }); }, { threshold: 0.15 });
  revealEls.forEach(el => observer.observe(el));

  // ============ 3D VOXEL PARTICLE E.T. FACE ============
  (function() {
    const wrap = document.getElementById('etFaceWrap');
    const canvas = document.getElementById('etFaceCanvas');
    const ctx = canvas.getContext('2d');
    let W, H, cubes = [];

    function resize() {
      const rect = wrap.getBoundingClientRect();
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      W = canvas.width = rect.width * dpr;
      H = canvas.height = rect.height * dpr;
      canvas.style.width = rect.width + 'px';
      canvas.style.height = rect.height + 'px';
    }

    // Paint ET's face onto a hidden canvas as a grayscale depth map, then sample it
    function createDepthMap() {
      const dC = document.createElement('canvas');
      const size = 512;
      dC.width = size; dC.height = size;
      const d = dC.getContext('2d');
      d.fillStyle = '#000';
      d.fillRect(0, 0, size, size);

      const cx = size * 0.50;
      const cy = size * 0.38;

      function ellipse(x, y, rx, ry, color) {
        d.beginPath(); d.ellipse(x, y, rx, ry, 0, 0, Math.PI * 2);
        d.fillStyle = color; d.fill();
      }
      function grad(x, y, r1, r2, c1, c2) {
        const g = d.createRadialGradient(x, y, r1, x, y, r2);
        g.addColorStop(0, c1); g.addColorStop(1, c2); return g;
      }

      // ---- HEAD SHAPE: Very wide bulbous cranium ----
      // ET's head is VERY wide at the temples, egg-shaped, narrow at chin
      d.beginPath();
      d.moveTo(cx, cy - 165); // top of head
      // Right side of cranium ‚Äî very wide bulge
      d.bezierCurveTo(cx + 80, cy - 175, cx + 175, cy - 140, cx + 185, cy - 60);
      // Right temple/cheek ‚Äî wide then narrowing
      d.bezierCurveTo(cx + 190, cy + 10, cx + 160, cy + 60, cx + 110, cy + 90);
      // Right jaw ‚Äî narrowing quickly
      d.bezierCurveTo(cx + 75, cy + 115, cx + 45, cy + 130, cx + 25, cy + 140);
      // Chin
      d.bezierCurveTo(cx + 10, cy + 148, cx - 10, cy + 148, cx - 25, cy + 140);
      // Left jaw
      d.bezierCurveTo(cx - 45, cy + 130, cx - 75, cy + 115, cx - 110, cy + 90);
      // Left temple
      d.bezierCurveTo(cx - 160, cy + 60, cx - 190, cy + 10, cx - 185, cy - 60);
      // Left cranium
      d.bezierCurveTo(cx - 175, cy - 140, cx - 80, cy - 175, cx, cy - 165);
      d.closePath();
      // 3D shading gradient ‚Äî light from upper-left
      d.fillStyle = grad(cx - 30, cy - 70, 10, 200, '#808080', '#1a1a1a');
      d.fill();

      // Cranium dome highlight
      d.beginPath();
      d.ellipse(cx - 15, cy - 110, 100, 55, 0, 0, Math.PI * 2);
      d.fillStyle = grad(cx - 15, cy - 115, 0, 80, '#a0a0a0', 'transparent');
      d.fill();

      // Side highlight (3D volume)
      d.beginPath();
      d.ellipse(cx - 60, cy - 30, 60, 120, 0.1, 0, Math.PI * 2);
      d.fillStyle = grad(cx - 70, cy - 30, 0, 80, 'rgba(150,150,150,0.25)', 'transparent');
      d.fill();

      // ---- HEAVY WRINKLES across entire face ----
      d.save();
      d.globalCompositeOperation = 'overlay';
      // Forehead wrinkles ‚Äî many deep horizontal lines
      for (let i = 0; i < 10; i++) {
        const yy = cy - 155 + i * 14;
        const width = 80 + i * 10;
        d.beginPath();
        d.moveTo(cx - width, yy);
        for (let wx = -width; wx <= width; wx += 20) {
          d.lineTo(cx + wx, yy + Math.sin(wx * 0.04 + i) * 3);
        }
        d.strokeStyle = `rgba(${i % 2 === 0 ? '50,50,50' : '120,120,120'},${0.3 + i * 0.02})`;
        d.lineWidth = 1.5 + Math.sin(i * 0.7) * 0.8;
        d.stroke();
      }

      // Under-eye and cheek wrinkles ‚Äî concentric curves around eyes
      for (let side = -1; side <= 1; side += 2) {
        for (let i = 0; i < 7; i++) {
          d.beginPath();
          const ox = side * 60;
          const startY = cy + 25 + i * 11;
          d.moveTo(cx + ox + side * 30, startY - 10);
          d.bezierCurveTo(
            cx + ox + side * 50, startY,
            cx + ox + side * 60, startY + 15,
            cx + ox + side * 55, startY + 30
          );
          d.strokeStyle = `rgba(60,60,60,${0.2 + i * 0.03})`;
          d.lineWidth = 1.2;
          d.stroke();
        }
      }

      // Nasolabial folds (deep creases from nose to mouth)
      for (let side = -1; side <= 1; side += 2) {
        d.beginPath();
        d.moveTo(cx + side * 18, cy + 45);
        d.bezierCurveTo(cx + side * 30, cy + 65, cx + side * 50, cy + 85, cx + side * 65, cy + 100);
        d.strokeStyle = 'rgba(40,40,40,0.4)';
        d.lineWidth = 2.5;
        d.stroke();
        // Lighter adjacent crease
        d.beginPath();
        d.moveTo(cx + side * 22, cy + 45);
        d.bezierCurveTo(cx + side * 35, cy + 65, cx + side * 55, cy + 85, cx + side * 70, cy + 100);
        d.strokeStyle = 'rgba(100,100,100,0.25)';
        d.lineWidth = 1.5;
        d.stroke();
      }
      d.restore();

      // ---- DEEP BROW RIDGE ----
      d.beginPath();
      d.moveTo(cx - 130, cy - 25);
      d.bezierCurveTo(cx - 100, cy - 50, cx - 40, cy - 55, cx, cy - 48);
      d.bezierCurveTo(cx + 40, cy - 55, cx + 100, cy - 50, cx + 130, cy - 25);
      d.bezierCurveTo(cx + 100, cy - 38, cx + 40, cy - 42, cx, cy - 36);
      d.bezierCurveTo(cx - 40, cy - 42, cx - 100, cy - 38, cx - 130, cy - 25);
      d.closePath();
      d.fillStyle = '#707070';
      d.fill();

      // Bridge between eyes ‚Äî deeper ridge
      d.beginPath();
      d.ellipse(cx, cy - 30, 20, 18, 0, 0, Math.PI * 2);
      d.fillStyle = 'rgba(90,90,90,0.5)';
      d.fill();

      // ---- EYE SOCKETS (very deep, hollow, void-like) ----
      // Outer socket rim
      ellipse(cx - 62, cy - 5, 50, 42, '#0c0c0c');
      ellipse(cx + 62, cy - 5, 50, 42, '#0c0c0c');
      // Deep inner socket ‚Äî pure void
      ellipse(cx - 62, cy - 3, 44, 36, '#020202');
      ellipse(cx + 62, cy - 3, 44, 36, '#020202');
      // Faint rim catch light ‚Äî just the edge of the socket
      d.beginPath(); d.ellipse(cx - 62, cy - 5, 48, 40, 0, 0, Math.PI * 2);
      d.strokeStyle = 'rgba(80,80,80,0.2)'; d.lineWidth = 1; d.stroke();
      d.beginPath(); d.ellipse(cx + 62, cy - 5, 48, 40, 0, 0, Math.PI * 2);
      d.strokeStyle = 'rgba(80,80,80,0.2)'; d.lineWidth = 1; d.stroke();

      // ---- UNDER-EYE POUCHES ----
      d.beginPath();
      d.ellipse(cx - 60, cy + 32, 42, 14, 0.05, 0, Math.PI);
      d.fillStyle = '#4a4a4a'; d.fill();
      d.beginPath();
      d.ellipse(cx + 60, cy + 32, 42, 14, -0.05, 0, Math.PI);
      d.fillStyle = '#4a4a4a'; d.fill();

      // ---- NOSE ----
      d.beginPath();
      d.moveTo(cx - 3, cy + 10);
      d.bezierCurveTo(cx - 8, cy + 35, cx - 14, cy + 55, cx - 10, cy + 68);
      d.bezierCurveTo(cx - 5, cy + 78, cx + 5, cy + 78, cx + 10, cy + 68);
      d.bezierCurveTo(cx + 14, cy + 55, cx + 8, cy + 35, cx + 3, cy + 10);
      d.closePath();
      d.fillStyle = '#6a6a6a'; d.fill();
      ellipse(cx, cy + 70, 16, 11, '#787878');
      // Nose highlight
      d.beginPath();
      d.moveTo(cx - 1, cy + 20);
      d.bezierCurveTo(cx + 1, cy + 40, cx + 2, cy + 55, cx + 1, cy + 65);
      d.strokeStyle = 'rgba(170,170,170,0.25)'; d.lineWidth = 3; d.stroke();
      // Nostrils
      ellipse(cx - 9, cy + 73, 6, 4.5, '#0e0e0e');
      ellipse(cx + 9, cy + 73, 6, 4.5, '#0e0e0e');

      // ---- MOUTH ----
      d.beginPath();
      d.moveTo(cx - 55, cy + 95);
      d.bezierCurveTo(cx - 30, cy + 108, cx + 30, cy + 108, cx + 55, cy + 95);
      d.bezierCurveTo(cx + 30, cy + 103, cx - 30, cy + 103, cx - 55, cy + 95);
      d.closePath();
      d.fillStyle = '#151515'; d.fill();
      // Upper lip line
      d.beginPath();
      d.moveTo(cx - 52, cy + 94);
      d.bezierCurveTo(cx - 25, cy + 88, cx + 25, cy + 88, cx + 52, cy + 94);
      d.strokeStyle = '#555'; d.lineWidth = 2; d.stroke();
      // Lower lip
      d.beginPath();
      d.ellipse(cx, cy + 108, 35, 9, 0, 0, Math.PI);
      d.fillStyle = '#4a4a4a'; d.fill();

      // ---- CHIN ----
      d.beginPath();
      d.ellipse(cx, cy + 130, 35, 12, 0, 0, Math.PI);
      d.fillStyle = 'rgba(80,80,80,0.3)'; d.fill();

      // ---- CHEEK VOLUMES ----
      d.beginPath();
      d.ellipse(cx - 95, cy + 30, 40, 45, 0.15, 0, Math.PI * 2);
      d.fillStyle = 'rgba(70,70,70,0.35)'; d.fill();
      d.beginPath();
      d.ellipse(cx + 95, cy + 30, 40, 45, -0.15, 0, Math.PI * 2);
      d.fillStyle = 'rgba(75,75,75,0.35)'; d.fill();

      // ---- FINAL 3D SHADING PASSES ----
      // Rim darkening on right
      d.globalCompositeOperation = 'multiply';
      const rimR = d.createLinearGradient(cx + 50, 0, cx + 190, 0);
      rimR.addColorStop(0, 'rgba(255,255,255,1)');
      rimR.addColorStop(1, 'rgba(120,120,120,1)');
      d.fillStyle = rimR; d.fillRect(0, 0, size, size);

      // Bottom darkening
      const botS = d.createLinearGradient(0, cy + 60, 0, cy + 160);
      botS.addColorStop(0, 'rgba(255,255,255,1)');
      botS.addColorStop(1, 'rgba(150,150,150,1)');
      d.fillStyle = botS; d.fillRect(0, 0, size, size);
      d.globalCompositeOperation = 'source-over';

      // Top light bloom
      d.globalCompositeOperation = 'screen';
      const topL = d.createRadialGradient(cx - 30, cy - 100, 0, cx, cy - 40, 130);
      topL.addColorStop(0, 'rgba(50,50,50,0.4)');
      topL.addColorStop(1, 'rgba(0,0,0,0)');
      d.fillStyle = topL; d.fillRect(0, 0, size, size);
      d.globalCompositeOperation = 'source-over';

      return dC;
    }

    function buildFace() {
      cubes = [];
      const depthCanvas = createDepthMap();
      const depthCtx = depthCanvas.getContext('2d');
      const depthData = depthCtx.getImageData(0, 0, 512, 512);
      const dd = depthData.data;

      const step = Math.max(3, Math.floor(Math.min(W, H) / 110));
      const scaleX = W / 512;
      const scaleY = H / 512;

      // Center of face in canvas coords
      const faceCX = W * 0.50;
      const faceCY = H * 0.38;

      for (let my = 0; my < 512; my += step / scaleY) {
        for (let mx = 0; mx < 512; mx += step / scaleX) {
          const imx = Math.floor(mx);
          const imy = Math.floor(my);
          if (imx >= 512 || imy >= 512) continue;
          const idx = (imy * 512 + imx) * 4;
          const rr = dd[idx], gg = dd[idx + 1], bb = dd[idx + 2];
          const brightness = (rr + gg + bb) / 3;
          if (brightness < 8) continue;

          const depth = brightness / 255;
          const px = mx * scaleX;
          const py = my * scaleY;

          // Distance from center for dispersal
          const dnx = (mx - 256) / 256;
          const dny = (my - 195) / 256;
          const distFromCenter = Math.sqrt(dnx * dnx + dny * dny);

          // Edge dispersal ‚Äî skip more particles further from center
          const edgeFactor = distFromCenter / 1.0;
          if (edgeFactor > 0.55) {
            const skipChance = (edgeFactor - 0.55) * 2.2;
            if (Math.random() < skipChance * 0.5) continue;
          }

          // Floating dispersal particles
          let fx = 0, fy = 0, isFloater = false;
          let floatAlphaMult = 1;
          if (edgeFactor > 0.5) {
            const disperseChance = (edgeFactor - 0.5) * 2.0;
            if (Math.random() < disperseChance * 0.6) {
              isFloater = true;
              const angle = Math.atan2(dny, dnx) + (Math.random() - 0.5) * 1.8;
              const dist = (edgeFactor - 0.5) * (40 + Math.random() * 120) * scaleX;
              fx = Math.cos(angle) * dist;
              fy = Math.sin(angle) * dist;
              floatAlphaMult = Math.max(0.05, 1 - dist / (150 * scaleX));
            }
          }

          // Map original colors to green scheme
          const isHighlight = rr > 200 && gg > 200 && bb > 200;
          const isVoid = brightness < 12;

          let cr, cg, cb, alpha;
          if (isHighlight) {
            cr = 200; cg = 255; cb = 200;
            alpha = 0.9;
          } else if (isVoid) {
            // Hollow eye sockets ‚Äî near-invisible dark particles
            cr = 2; cg = 8; cb = 2;
            alpha = 0.15;
          } else {
            // Green mapped from brightness
            cr = Math.floor(10 + depth * 50);
            cg = Math.floor(40 + depth * 215);
            cb = Math.floor(5 + depth * 20);
            alpha = 0.2 + depth * 0.7;
          }

          alpha *= floatAlphaMult;

          // 3D isometric offset
          const isoX = depth * step * 1.2;
          const isoY = -depth * step * 1.2;

          const sizeMultiplier = isFloater
            ? (0.3 + Math.random() * 0.9)
            : (0.65 + depth * 0.45 + Math.random() * 0.15);

          cubes.push({
            x: px + isoX + fx,
            y: py + isoY + fy,
            homeX: px + isoX,
            homeY: py + isoY,
            size: step * sizeMultiplier,
            depth,
            r: cr, g: cg, b: cb,
            alpha: Math.min(1, alpha),
            isFloater,
            phase: Math.random() * Math.PI * 2,
            driftSpeed: 0.2 + Math.random() * 0.6
          });
        }
      }

      // Sort back-to-front
      cubes.sort((a, b) => a.depth - b.depth);
    }

    function drawCube(c, time) {
      const s = c.size;
      const shimmer = 0.9 + 0.1 * Math.sin(time * 0.002 + c.phase);
      const a = c.alpha * shimmer;
      if (a < 0.01 || s < 0.4) return;

      const x = c.x, y = c.y;
      const light = 0.35 + c.depth * 0.65;
      const isoH = s * 0.35 * c.depth;
      const skewX = s * 0.28;

      // Right face
      ctx.fillStyle = `rgba(${Math.floor(c.r*light*0.35)},${Math.floor(c.g*light*0.35)},${Math.floor(c.b*light*0.35)},${a*0.7})`;
      ctx.beginPath();
      ctx.moveTo(x+s, y); ctx.lineTo(x+s+skewX, y-isoH);
      ctx.lineTo(x+s+skewX, y-isoH+s); ctx.lineTo(x+s, y+s);
      ctx.closePath(); ctx.fill();

      // Top face
      ctx.fillStyle = `rgba(${Math.floor(c.r*light*0.65)},${Math.floor(c.g*light*0.65)},${Math.floor(c.b*light*0.65)},${a*0.5})`;
      ctx.beginPath();
      ctx.moveTo(x, y); ctx.lineTo(x+skewX, y-isoH);
      ctx.lineTo(x+s+skewX, y-isoH); ctx.lineTo(x+s, y);
      ctx.closePath(); ctx.fill();

      // Front face
      ctx.fillStyle = `rgba(${Math.floor(c.r*light)},${Math.floor(c.g*light)},${Math.floor(c.b*light)},${a})`;
      ctx.fillRect(x, y, s, s);

      // Wireframe edges
      ctx.strokeStyle = `rgba(${c.r},${c.g},${c.b},${a*0.18})`;
      ctx.lineWidth = 0.5;
      ctx.strokeRect(x, y, s, s);
      ctx.beginPath();
      ctx.moveTo(x, y); ctx.lineTo(x+skewX, y-isoH);
      ctx.moveTo(x+s, y); ctx.lineTo(x+s+skewX, y-isoH);
      ctx.stroke();
    }

    function render(time) {
      ctx.clearRect(0, 0, W, H);
      const breathe = Math.sin(time * 0.0008) * 1.5;

      for (const c of cubes) {
        if (c.isFloater) {
          c.x += Math.sin(time * 0.0004 + c.phase) * 0.08 * c.driftSpeed;
          c.y += Math.cos(time * 0.0003 + c.phase) * 0.06 * c.driftSpeed;
        } else {
          c.y = c.homeY + breathe * (1 - c.depth * 0.4);
        }
        drawCube(c, time);
      }

      requestAnimationFrame(render);
    }

    function init() { resize(); buildFace(); requestAnimationFrame(render); }
    if (document.fonts && document.fonts.ready) {
      document.fonts.ready.then(() => setTimeout(init, 100));
    } else { setTimeout(init, 300); }
    window.addEventListener('resize', () => { resize(); buildFace(); });
  })();
</script>
</body>
</html>
